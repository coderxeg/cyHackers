import base64
exec(base64.b64decode('IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwojIC0qLSBjb2Rpbmc6IHV0Zi04IC0qLQojIFRlcm11eCBNdWx0aVRvb2wgdjYuMCAtIERldmVsb3BlciBFZGl0aW9uCiMgQXV0aG9yOiBDeWJlclRvb2xzCiMgSW1wcm92ZWQgYnk6IEFJIEFzc2lzdGFudAppbXBvcnQgaW1wb3J0bGliCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBzeXMKCmRlZiBlbnN1cmVfZGVwZW5kZW5jaWVzKHBhY2thZ2VzKToKICAgIGZvciBwYWNrYWdlIGluIHBhY2thZ2VzOgogICAgICAgIHRyeToKICAgICAgICAgICAgaW1wb3J0bGliLmltcG9ydF9tb2R1bGUocGFja2FnZSkKICAgICAgICAgICAgcHJpbnQoZiLinIUge3BhY2thZ2V9INmF2YjYrNmI2K/YqSIpCiAgICAgICAgZXhjZXB0IEltcG9ydEVycm9yOgogICAgICAgICAgICBwcmludChmIvCfk6Yge3BhY2thZ2V9INi62YrYsSDZhdmI2KzZiNiv2KnYjCDYrNin2LHZiiDYqtir2KjZitiq2YfYpy4uLiIpCiAgICAgICAgICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICItbSIsICJwaXAiLCAiaW5zdGFsbCIsIHBhY2thZ2VdKQoKIyDwn6egINiu2LHZiti32Kkg2KjZitmGINin2LPZhSDYp9mE2KjYp9mD2YrYrCDZiNin2LPZhSDYp9mE2YXZg9iq2KjYqSAo2KjYudi22YfZhSDZhdiu2KrZhNmB2YrZhikKcmVxdWlyZWRfcGFja2FnZXMgPSB7CiAgICAidGVybWNvbG9yIjogInRlcm1jb2xvciIsCiAgICAicHlmaWdsZXQiOiAicHlmaWdsZXQiLAogICAgInRlbGVib3QiOiAicHlUZWxlZ3JhbUJvdEFQSSIsICAjINmF2YPYqtio2KkgdGVsZWJvdCDYp9iz2YXZh9inINin2YTZgdi52YTZiiBweVRlbGVncmFtQm90QVBJCn0KCiMg8J+nqiDYqtir2KjZitiq2YfZhSDYp9mE2KLZhgplbnN1cmVfZGVwZW5kZW5jaWVzKHJlcXVpcmVkX3BhY2thZ2VzLnZhbHVlcygpKQoKaW1wb3J0IHN5cwppbXBvcnQgdGltZQppbXBvcnQgc29ja2V0CmltcG9ydCBvcwppbXBvcnQgcmFuZG9tCmltcG9ydCBoYXNobGliCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCByZQppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCBqc29uCmltcG9ydCBsb2dnaW5nCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gdXJsbGliLnJlcXVlc3QgaW1wb3J0IHVybG9wZW4KZnJvbSB1cmxsaWIucGFyc2UgaW1wb3J0IHF1b3RlCmZyb20gaW1wb3J0bGliIGltcG9ydCBpbXBvcnRfbW9kdWxlCmZyb20gdGVybWNvbG9yIGltcG9ydCBjb2xvcmVkCmZyb20gcHlmaWdsZXQgaW1wb3J0IEZpZ2xldAppbXBvcnQgdGVsZWJvdApmcm9tIHRlbGVib3QgaW1wb3J0IHR5cGVzCmltcG9ydCBiYXNlNjQKCgpjbGFzcyBTZWN1cmVFbmNyeXB0b3I6CiAgICAiIiJTZWN1cmUgZW5jcnlwdGlvbiBjbGFzcyB1c2luZyBYT1IiIiIKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBrZXk9Tm9uZSk6CiAgICAgICAgaWYga2V5IGlzIE5vbmU6CiAgICAgICAgICAgICMgR2VuZXJhdGUgYSByYW5kb20ga2V5IGlmIG5vbmUgcHJvdmlkZWQKICAgICAgICAgICAga2V5ID0gJycuam9pbihyYW5kb20uY2hvaWNlcygnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjAxMjM0NTY3ODknLCBrPTMyKSkKICAgICAgICBzZWxmLmtleSA9IGtleS5lbmNvZGUoKQogICAgICAgIAogICAgZGVmIGVuY3J5cHQoc2VsZiwgZGF0YSk6CiAgICAgICAgIiIiRW5jcnlwdCBkYXRhIHVzaW5nIFhPUiBvcGVyYXRpb24iIiIKICAgICAgICBpZiBpc2luc3RhbmNlKGRhdGEsIHN0cik6CiAgICAgICAgICAgIGRhdGEgPSBkYXRhLmVuY29kZSgpCiAgICAgICAgZW5jcnlwdGVkID0gYnl0ZWFycmF5KCkKICAgICAgICBrZXlfbGVuZ3RoID0gbGVuKHNlbGYua2V5KQogICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihkYXRhKSk6CiAgICAgICAgICAgIGVuY3J5cHRlZC5hcHBlbmQoZGF0YVtpXSBeIHNlbGYua2V5W2kgJSBrZXlfbGVuZ3RoXSkKICAgICAgICByZXR1cm4gYmFzZTY0LmI2NGVuY29kZShlbmNyeXB0ZWQpLmRlY29kZSgpCiAgICAgICAgCiAgICBkZWYgZGVjcnlwdChzZWxmLCBlbmNfZGF0YSk6CiAgICAgICAgIiIiRGVjcnlwdCBkYXRhIHVzaW5nIFhPUiBvcGVyYXRpb24iIiIKICAgICAgICBpZiBpc2luc3RhbmNlKGVuY19kYXRhLCBzdHIpOgogICAgICAgICAgICBlbmNfZGF0YSA9IGVuY19kYXRhLmVuY29kZSgpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBlbmNyeXB0ZWQgPSBiYXNlNjQuYjY0ZGVjb2RlKGVuY19kYXRhKQogICAgICAgICAgICBkZWNyeXB0ZWQgPSBieXRlYXJyYXkoKQogICAgICAgICAgICBrZXlfbGVuZ3RoID0gbGVuKHNlbGYua2V5KQogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZW5jcnlwdGVkKSk6CiAgICAgICAgICAgICAgICBkZWNyeXB0ZWQuYXBwZW5kKGVuY3J5cHRlZFtpXSBeIHNlbGYua2V5W2kgJSBrZXlfbGVuZ3RoXSkKICAgICAgICAgICAgcmV0dXJuIGRlY3J5cHRlZC5kZWNvZGUoKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcmV0dXJuICIiCgpjbGFzcyBUZXJtdXhNdWx0aVRvb2w6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgIyBWZXJzaW9uIHNldHRpbmdzCiAgICAgICAgc2VsZi52ZXJzaW9uID0gIjYuMCIKICAgICAgICBzZWxmLmF1dGhvciA9ICJDeWJlclRvb2xzIHwg4piq77iO2YTYpyDYpdmE2Ycg2KXZhNinINin2YTZhNmHIiAKICAgICAgICBzZWxmLnVwZGF0ZV9kYXRlID0gIjIwMjUtMDQtMDciCiAgICAgICAgCiAgICAgICAgIyBTZWN1cml0eSBzZXR0aW5ncwogICAgICAgIHNlbGYuc2V0dXBfbG9nZ2luZygpCiAgICAgICAgc2VsZi5zZWN1cml0eV9jaGVja3MoKQogICAgICAgIAogICAgICAgICMgUmVxdWlyZW1lbnRzCiAgICAgICAgc2VsZi5yZXF1aXJlZF9tb2R1bGVzID0gWwogICAgICAgICAgICAoJ3Rlcm1jb2xvcicsICd0ZXJtY29sb3InKSwKICAgICAgICAgICAgKCdweWZpZ2xldCcsICdweWZpZ2xldCcpLAogICAgICAgICAgICAoJ3JlcXVlc3RzJywgJ3JlcXVlc3RzJyksCiAgICAgICAgICAgICgndGVsZWJvdCcsICdweVRlbGVncmFtQm90QVBJJykKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgIyBSZXF1aXJlZCBUZXJtdXggcGFja2FnZXMKICAgICAgICBzZWxmLnRlcm11eF9wYWNrYWdlcyA9IFsKICAgICAgICAgICAgJ2Jhc2gnLCAnZ2l0JywgJ3B5dGhvbicsICdjdXJsJywgJ3dnZXQnLAogICAgICAgICAgICAnbm1hcCcsICdvcGVuc3NoJywgJ3ZpbScsICdjbGFuZycsICdtYWtlJywKICAgICAgICAgICAgJ3dpcmVsZXNzLXRvb2xzJywgJ25ldC10b29scycsICd0ZXJtdXgtYXBpJwogICAgICAgIF0KICAgICAgICAKICAgICAgICAjIFRlbGVncmFtIEJvdCBzZXR0aW5ncwogICAgICAgIHNlbGYudGVsZWdyYW1fYm90X3Rva2VuID0gIjcyNTk0OTI4MzU6QUFId2t6c1ZXdVVrbjF6ZFlnaWpLS1RxTTUyNDhsYmxSN28iCiAgICAgICAgc2VsZi5ib3QgPSB0ZWxlYm90LlRlbGVCb3Qoc2VsZi50ZWxlZ3JhbV9ib3RfdG9rZW4pCiAgICAgICAgc2VsZi5lbmNyeXB0b3IgPSBTZWN1cmVFbmNyeXB0b3IoKQogICAgICAgIAogICAgICAgICMgQXV0aGVudGljYXRpb24gc3lzdGVtCiAgICAgICAgc2VsZi5vdHBfY29kZXMgPSB7fQogICAgICAgIHNlbGYub3RwX2V4cGlyeSA9IHt9CiAgICAgICAgc2VsZi5mYWlsZWRfYXR0ZW1wdHMgPSB7fQogICAgICAgIHNlbGYuYXV0aGVudGljYXRlZF91c2VycyA9IHNldCgpCiAgICAgICAgc2VsZi5hbGxvd2VkX3VzZXJzID0gc2VsZi5fbG9hZF9hbGxvd2VkX3VzZXJzKCkKICAgICAgICBzZWxmLm90cF9yZXRyeV9kZWxheSA9IDYwICAjIHNlY29uZHMgYmV0d2VlbiBhdHRlbXB0cwogICAgICAgIAogICAgICAgICMgQ2hlY2sgcmVxdWlyZW1lbnRzCiAgICAgICAgc2VsZi5jaGVja19yZXF1aXJlbWVudHMoKQogICAgICAgIHNlbGYuaW5pdGlhbGl6ZV91aSgpCiAgICAgICAgCiAgICAgICAgIyBUb29scyBjb25maWd1cmF0aW9uCiAgICAgICAgc2VsZi50b29sc19jb25maWcgPSBzZWxmLl9sb2FkX3Rvb2xzX2NvbmZpZygpCgogICAgZGVmIHNldHVwX2xvZ2dpbmcoc2VsZik6CiAgICAgICAgIiIiU2V0IHVwIGxvZ2dpbmcgc3lzdGVtIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb2dnaW5nLmJhc2ljQ29uZmlnKAogICAgICAgICAgICAgICAgZmlsZW5hbWU9J3Rlcm11eF90b29sLmxvZycsCiAgICAgICAgICAgICAgICBsZXZlbD1sb2dnaW5nLklORk8sCiAgICAgICAgICAgICAgICBmb3JtYXQ9JyUoYXNjdGltZSlzIC0gJShsZXZlbG5hbWUpcyAtICUobWVzc2FnZSlzJywKICAgICAgICAgICAgICAgIGZpbGVtb2RlPSdhJwogICAgICAgICAgICApCiAgICAgICAgICAgIGxvZ2dpbmcuaW5mbygiVG9vbCBzdGFydGVkIHN1Y2Nlc3NmdWxseSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkZhaWxlZCB0byBzZXR1cCBsb2dnaW5nOiB7ZX0iKQogICAgICAgICAgICBzeXMuZXhpdCgxKQoKICAgIGRlZiBzZWN1cml0eV9jaGVja3Moc2VsZik6CiAgICAgICAgIiIiSW5pdGlhbCBzZWN1cml0eSBjaGVja3MiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ2hlY2sgZmlsZSBwZXJtaXNzaW9ucwogICAgICAgICAgICBzZW5zaXRpdmVfZmlsZXMgPSBbJ2FsbG93ZWRfdXNlcnMudHh0JywgJ3Rvb2xzX2NvbmZpZy5qc29uJ10KICAgICAgICAgICAgZm9yIGZpbGUgaW4gc2Vuc2l0aXZlX2ZpbGVzOgogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoZmlsZSk6CiAgICAgICAgICAgICAgICAgICAgbW9kZSA9IG9zLnN0YXQoZmlsZSkuc3RfbW9kZQogICAgICAgICAgICAgICAgICAgIGlmIG1vZGUgJiAwbzc3NyAhPSAwbzYwMDoKICAgICAgICAgICAgICAgICAgICAgICAgb3MuY2htb2QoZmlsZSwgMG82MDApCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dpbmcud2FybmluZyhmIk1vZGlmaWVkIGZpbGUgcGVybWlzc2lvbnM6IHtmaWxlfSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiU2VjdXJpdHkgY2hlY2sgZXJyb3I6IHtzdHIoZSl9IikKICAgICAgICAgICAgcHJpbnQoZiJTZWN1cml0eSBjaGVjayBlcnJvcjoge2V9IikKCiAgICBkZWYgX2xvYWRfYWxsb3dlZF91c2VycyhzZWxmKToKICAgICAgICAiIiJMb2FkIGFsbG93ZWQgdXNlcnMgZnJvbSBmaWxlIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb25maWdfcGF0aCA9IG9zLnBhdGguam9pbihvcy5wYXRoLmRpcm5hbWUoX19maWxlX18pLCAnYWxsb3dlZF91c2Vycy50eHQnKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhjb25maWdfcGF0aCk6CiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oY29uZmlnX3BhdGgsICdyJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2V0KGxpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmIGlmIGxpbmUuc3RyaXAoKSkKICAgICAgICAgICAgcmV0dXJuIHNldCgpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgbG9hZGluZyBhbGxvd2VkIHVzZXJzOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHByaW50KGYiRXJyb3IgbG9hZGluZyBhbGxvd2VkIHVzZXJzOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gc2V0KCkKCiAgICBkZWYgX2xvYWRfdG9vbHNfY29uZmlnKHNlbGYpOgogICAgICAgICIiIkxvYWQgdG9vbHMgY29uZmlndXJhdGlvbiBmcm9tIEpTT04gZmlsZSIiIgogICAgICAgIGRlZmF1bHRfY29uZmlnID0gewogICAgICAgICAgICAid2hhdHNhcHBfdG9vbHMiOiB7ImVuYWJsZWQiOiBUcnVlfSwKICAgICAgICAgICAgInNvY2tldF90b29scyI6IHsiZW5hYmxlZCI6IFRydWV9LAogICAgICAgICAgICAic2VjdXJpdHlfdG9vbHMiOiB7ImVuYWJsZWQiOiBUcnVlfSwKICAgICAgICAgICAgInRlcm11eF91dGlsaXRpZXMiOiB7ImVuYWJsZWQiOiBUcnVlfSwKICAgICAgICAgICAgIndpZmlfdG9vbHMiOiB7ImVuYWJsZWQiOiBUcnVlfQogICAgICAgIH0KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbmZpZ19wYXRoID0gb3MucGF0aC5qb2luKG9zLnBhdGguZGlybmFtZShfX2ZpbGVfXyksICd0b29sc19jb25maWcuanNvbicpCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGNvbmZpZ19wYXRoKToKICAgICAgICAgICAgICAgIHdpdGggb3Blbihjb25maWdfcGF0aCwgJ3InKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBqc29uLmxvYWQoZikKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRfY29uZmlnCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgbG9hZGluZyB0b29scyBjb25maWc6IHtzdHIoZSl9IikKICAgICAgICAgICAgcHJpbnQoZiJFcnJvciBsb2FkaW5nIHRvb2xzIGNvbmZpZzoge2V9IikKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRfY29uZmlnCgogICAgZGVmIGNoZWNrX3JlcXVpcmVtZW50cyhzZWxmKToKICAgICAgICAiIiJDaGVjayByZXF1aXJlbWVudHMgYW5kIGluc3RhbGwgbWlzc2luZyBvbmVzIiIiCiAgICAgICAgbWlzc2luZ19tb2R1bGVzID0gW10KICAgICAgICBmb3IgbW9kdWxlX25hbWUsIHBhY2thZ2VfbmFtZSBpbiBzZWxmLnJlcXVpcmVkX21vZHVsZXM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGltcG9ydF9tb2R1bGUobW9kdWxlX25hbWUpCiAgICAgICAgICAgIGV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICAgICAgICAgICAgIG1pc3NpbmdfbW9kdWxlcy5hcHBlbmQocGFja2FnZV9uYW1lKQogICAgICAgIAogICAgICAgIGlmIG1pc3NpbmdfbW9kdWxlczoKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiSW5zdGFsbGluZyBtaXNzaW5nIHJlcXVpcmVtZW50cy4uLiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5jaGVja19jYWxsKFtzeXMuZXhlY3V0YWJsZSwgIi1tIiwgInBpcCIsICJpbnN0YWxsIiwgIi0tdXBncmFkZSJdICsgbWlzc2luZ19tb2R1bGVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5ERVZOVUxMLCBzdGRlcnI9c3VicHJvY2Vzcy5ERVZOVUxMKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiUmVxdWlyZW1lbnRzIGluc3RhbGxlZCBzdWNjZXNzZnVsbHkhIiwgJ2dyZWVuJykpCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICBvcy5leGVjbChzeXMuZXhlY3V0YWJsZSwgc3lzLmV4ZWN1dGFibGUsICpzeXMuYXJndikKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkZhaWxlZCB0byBpbnN0YWxsIHJlcXVpcmVtZW50czoge3N0cihlKX0iKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIkZhaWxlZCB0byBpbnN0YWxsIHJlcXVpcmVtZW50czoge2V9IiwgJ3JlZCcpKQogICAgICAgICAgICAgICAgc3lzLmV4aXQoMSkKCiAgICBkZWYgaW5pdGlhbGl6ZV91aShzZWxmKToKICAgICAgICAiIiJJbml0aWFsaXplIHVzZXIgaW50ZXJmYWNlIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBvcy5zeXN0ZW0oJ2NsZWFyJykKICAgICAgICAgICAgc2VsZi5maWcgPSBGaWdsZXQoZm9udD0nc3RhbmRhcmQnKSAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChjb2xvcmVkKHNlbGYuZmlnLnJlbmRlclRleHQoJ1RFUk1VWCBUT09MJyksICdjeWFuJykpCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiJWZXJzaW9uOiB7c2VsZi52ZXJzaW9ufSB8IEF1dGhvcjoge3NlbGYuYXV0aG9yfSB8IExhc3QgVXBkYXRlOiB7c2VsZi51cGRhdGVfZGF0ZX0iLCAneWVsbG93JykpCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIj0iKjYwLCAnbWFnZW50YScpKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBVSToge2V9IikKICAgICAgICAgICAgc3lzLmV4aXQoMSkKCiAgICBkZWYgc3RhcnRfdGVsZWdyYW1fYm90KHNlbGYpOgogICAgICAgICIiIlN0YXJ0IFRlbGVncmFtIGJvdCB3aXRoIGtleWJvYXJkIGJ1dHRvbnMgYW5kIGNoYW5uZWwgbGluayBidXR0b24iIiIKICAgICAgICBAc2VsZi5ib3QubWVzc2FnZV9oYW5kbGVyKGNvbW1hbmRzPVsnc3RhcnQnLCAnaGVscCddKQogICAgICAgIGRlZiBzZW5kX3dlbGNvbWUobWVzc2FnZSk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyDYpdmG2LTYp9ihINmD2YrYqNmI2LHYryDYsdim2YrYs9mKCiAgICAgICAgICAgICAgICAgICAgbWFpbl9tYXJrdXAgPSB0eXBlcy5SZXBseUtleWJvYXJkTWFya3VwKHJvd193aWR0aD0yLCByZXNpemVfa2V5Ym9hcmQ9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBidG4xID0gdHlwZXMuS2V5Ym9hcmRCdXR0b24oJ/CfhpQg2KfZhNit2LXZiNmEINi52YTZiSDYp9mE2KLZitiv2YonKQogICAgICAgICAgICAgICAgICAgIGJ0bjIgPSB0eXBlcy5LZXlib2FyZEJ1dHRvbign8J+UkCDYpdmG2LTYp9ihINmD2YjYryDYp9mE2KrYrdmC2YInKQogICAgICAgICAgICAgICAgICAgIGJ0bjMgPSB0eXBlcy5LZXlib2FyZEJ1dHRvbign8J+TiiDYrdin2YTYqSDYp9mE2K3Ys9in2KgnKQogICAgICAgICAgICAgICAgICAgIGJ0bjQgPSB0eXBlcy5LZXlib2FyZEJ1dHRvbign8J+aqiDYqtiz2KzZitmEINin2YTYrtix2YjYrCcpCiAgICAgICAgICAgICAgICAgICAgYnRuNSA9IHR5cGVzLktleWJvYXJkQnV0dG9uKCfwn5ug77iPINin2YTYo9iv2YjYp9iqINin2YTZhdiq2KfYrdipJykKICAgICAgICAgICAgICAgICAgICBtYWluX21hcmt1cC5hZGQoYnRuMSwgYnRuMiwgYnRuMywgYnRuNCwgYnRuNSkKCiAgICAgICAgICAgICAgICAgICAgd2VsY29tZV9tc2cgPSAiIiIKICAgICAgICDwn5qAICrZhdix2K3YqNin2Ysg2KjZgyDZgdmKINio2YjYqiBUZXJtdXggTXVsdGlUb29sKgoKICAgICAgICDwn5S5INin2LbYuti3INi52YTZiSDwn4aUINin2YTYrdi12YjZhCDYudmE2Ykg2KfZhNii2YrYr9mKINmE2YXYudix2YHYqSDYsdmC2YXZgwogICAgICAgIPCflLkg2KfYtti62Lcg2LnZhNmJIPCflJAg2KXZhti02KfYoSDZg9mI2K8g2KfZhNiq2K3ZgtmCINmE2KXZhti02KfYoSDZg9mI2K8gT1RQCiAgICAgICAg8J+UuSDYp9i22LrYtyDYudmE2Ykg8J+TiiDYrdin2YTYqSDYp9mE2K3Ys9in2Kgg2YTZhNiq2K3ZgtmCINmF2YYg2K3Yp9mE2Kkg2KfZhNmF2LXYp9iv2YLYqQogICAgICAgIPCflLkg2KfYtti62Lcg2LnZhNmJIPCfmqog2KrYs9is2YrZhCDYp9mE2K7YsdmI2Kwg2YTYpdmG2YfYp9ihINis2YXZiti5INin2YTYrNmE2LPYp9iqCiAgICAgICAg8J+UuSDYp9i22LrYtyDYudmE2Ykg8J+boO+4jyDYp9mE2KPYr9mI2KfYqiDYp9mE2YXYqtin2K3YqSDZhNix2KTZitipINin2YTYo9iv2YjYp9iqCgogICAgICAgIOKaoO+4jyAq2YTYpyDYqti02KfYsdmDINmD2YjYryDYp9mE2KrYrdmC2YIg2YXYuSDYo9mKINi02K7YtSEqCiAgICAgICAgICAgICAgICAgICAgIiIiCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyDYpdmG2LTYp9ihINil2YbZhNin2YrZhiDZg9mK2KjZiNix2K8g2YTYstixINin2YTZgtmG2KfYqQogICAgICAgICAgICAgICAgICAgIGNoYW5uZWxfbWFya3VwID0gdHlwZXMuSW5saW5lS2V5Ym9hcmRNYXJrdXAoKQogICAgICAgICAgICAgICAgICAgIGNoYW5uZWxfYnRuID0gdHlwZXMuSW5saW5lS2V5Ym9hcmRCdXR0b24odGV4dD0i2YLZhtin2KrZhtinINi52YTZiSDYp9mE2KrZhNmK2KzYsdin2YUiLCB1cmw9Imh0dHBzOi8vdC5tZS9TdG9yeV9HQSIpCiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbF9tYXJrdXAuYWRkKGNoYW5uZWxfYnRuKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg2KXYsdiz2KfZhCDYp9mE2LHYs9in2YTYqSDZhdi5INin2YTZg9mK2KjZiNix2K/ZitmGCiAgICAgICAgICAgICAgICAgICAgc2VsZi5ib3Quc2VuZF9tZXNzYWdlKG1lc3NhZ2UuY2hhdC5pZCwgd2VsY29tZV9tc2csIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iTWFya2Rvd24iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1tYWluX21hcmt1cCkKICAgICAgICAgICAgICAgICAgICBzZWxmLmJvdC5zZW5kX21lc3NhZ2UobWVzc2FnZS5jaGF0LmlkLCAi2KrYp9io2LnZhtinINmE2YTYrdi12YjZhCDYudmE2Ykg2KLYrtixINin2YTYqtit2K/Zitir2KfYqjoiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1jaGFubmVsX21hcmt1cCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2dnaW5nLmluZm8oZiJTZW50IHdlbGNvbWUgbWVzc2FnZSB0byB1c2VyOiB7bWVzc2FnZS5mcm9tX3VzZXIuaWR9IikKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgaW4gd2VsY29tZSBoYW5kbGVyOiB7c3RyKGUpfSIpCgogICAgICAgIEBzZWxmLmJvdC5tZXNzYWdlX2hhbmRsZXIoZnVuYz1sYW1iZGEgbWVzc2FnZTogbWVzc2FnZS50ZXh0ID09ICfwn4aUINin2YTYrdi12YjZhCDYudmE2Ykg2KfZhNii2YrYr9mKJykKICAgICAgICBkZWYgc2VuZF91c2VyX2lkKG1lc3NhZ2UpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB1c2VyX2lkID0gc3RyKG1lc3NhZ2UuZnJvbV91c2VyLmlkKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjINil2YbYtNin2KEg2KXZhtmE2KfZitmGINmD2YrYqNmI2LHYryDZhNiy2LEg2KfZhNmC2YbYp9ipCiAgICAgICAgICAgICAgICBjaGFubmVsX21hcmt1cCA9IHR5cGVzLklubGluZUtleWJvYXJkTWFya3VwKCkKICAgICAgICAgICAgICAgIGNoYW5uZWxfYnRuID0gdHlwZXMuSW5saW5lS2V5Ym9hcmRCdXR0b24odGV4dD0i2YLZhtin2KrZhtinINi52YTZiSDYp9mE2KrZhNmK2KzYsdin2YUiLCB1cmw9Imh0dHBzOi8vdC5tZS9TdG9yeV9HQSIpCiAgICAgICAgICAgICAgICBjaGFubmVsX21hcmt1cC5hZGQoY2hhbm5lbF9idG4pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuYm90LnNlbmRfbWVzc2FnZShtZXNzYWdlLmNoYXQuaWQsIGYi8J+UkSDYsdmC2YXZgyDYp9mE2K7Yp9i1OiB7dXNlcl9pZH0iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICAgICAgc2VsZi5ib3Quc2VuZF9tZXNzYWdlKG1lc3NhZ2UuY2hhdC5pZCwgItiq2KfYqNi52YbYpyDZhNmE2K3YtdmI2YQg2LnZhNmJINii2K7YsSDYp9mE2KrYrdiv2YrYq9in2Ko6IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1jaGFubmVsX21hcmt1cCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2luZy5pbmZvKGYiVXNlciByZXF1ZXN0ZWQgSUQ6IHt1c2VyX2lkfSIpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciBpbiBJRCBoYW5kbGVyOiB7c3RyKGUpfSIpCgogICAgICAgIEBzZWxmLmJvdC5tZXNzYWdlX2hhbmRsZXIoZnVuYz1sYW1iZGEgbWVzc2FnZTogbWVzc2FnZS50ZXh0ID09ICfwn5SQINil2YbYtNin2KEg2YPZiNivINin2YTYqtit2YLZgicpCiAgICAgICAgZGVmIGdlbmVyYXRlX290cChtZXNzYWdlKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdXNlcl9pZCA9IHN0cihtZXNzYWdlLmZyb21fdXNlci5pZCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgc2VsZi5mYWlsZWRfYXR0ZW1wdHMuZ2V0KHVzZXJfaWQsIHt9KS5nZXQoJ2NvdW50JywgMCkgPj0gMzoKICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdfdGltZSA9IHNlbGYuZ2V0X3JlbWFpbmluZ19kZWxheSh1c2VyX2lkKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg2KXZhti02KfYoSDYpdmG2YTYp9mK2YYg2YPZitio2YjYsdivINmE2LLYsSDYp9mE2YLZhtin2KkKICAgICAgICAgICAgICAgICAgICBjaGFubmVsX21hcmt1cCA9IHR5cGVzLklubGluZUtleWJvYXJkTWFya3VwKCkKICAgICAgICAgICAgICAgICAgICBjaGFubmVsX2J0biA9IHR5cGVzLklubGluZUtleWJvYXJkQnV0dG9uKHRleHQ9ItmC2YbYp9iq2YbYpyDYudmE2Ykg2KfZhNiq2YTZitis2LHYp9mFIiwgdXJsPSJodHRwczovL3QubWUvU3RvcnlfR0EiKQogICAgICAgICAgICAgICAgICAgIGNoYW5uZWxfbWFya3VwLmFkZChjaGFubmVsX2J0bikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmLmJvdC5zZW5kX21lc3NhZ2UobWVzc2FnZS5jaGF0LmlkLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYi4o+zINmE2YLYryDYqtis2KfZiNiy2Kog2KfZhNit2K8g2KfZhNmF2LPZhdmI2K0uINmK2LHYrNmJINin2YTYp9mG2KrYuNin2LEge3JlbWFpbmluZ190aW1lfSDYq9in2YbZitipIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9Ik1hcmtkb3duIikKICAgICAgICAgICAgICAgICAgICBzZWxmLmJvdC5zZW5kX21lc3NhZ2UobWVzc2FnZS5jaGF0LmlkLCAi2KrYp9io2LnZhtinINmE2YTYrdi12YjZhCDYudmE2Ykg2KLYrtixINin2YTYqtit2K/Zitir2KfYqjoiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1jaGFubmVsX21hcmt1cCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2dnaW5nLndhcm5pbmcoZiJPVFAgZ2VuZXJhdGlvbiBhdHRlbXB0IGFmdGVyIGxpbWl0IGZvciB1c2VyOiB7dXNlcl9pZH0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBzZWxmLmFsbG93ZWRfdXNlcnMgYW5kIHVzZXJfaWQgbm90IGluIHNlbGYuYWxsb3dlZF91c2VyczoKICAgICAgICAgICAgICAgICAgICBjaGFubmVsX21hcmt1cCA9IHR5cGVzLklubGluZUtleWJvYXJkTWFya3VwKCkKICAgICAgICAgICAgICAgICAgICBjaGFubmVsX2J0biA9IHR5cGVzLklubGluZUtleWJvYXJkQnV0dG9uKHRleHQ9ItmC2YbYp9iq2YbYpyDYudmE2Ykg2KfZhNiq2YTZitis2LHYp9mFIiwgdXJsPSJodHRwczovL3QubWUvU3RvcnlfR0EiKQogICAgICAgICAgICAgICAgICAgIGNoYW5uZWxfbWFya3VwLmFkZChjaGFubmVsX2J0bikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmLmJvdC5zZW5kX21lc3NhZ2UobWVzc2FnZS5jaGF0LmlkLCAi4puUICrYutmK2LEg2YXYs9mF2YjYrSDZhNmDINio2KfZhNiv2K7ZiNmEKiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICAgICAgICAgIHNlbGYuYm90LnNlbmRfbWVzc2FnZShtZXNzYWdlLmNoYXQuaWQsICLYqtin2KjYudmG2Kcg2YTZhNit2LXZiNmEINi52YTZiSDYotiu2LEg2KfZhNiq2K3Yr9mK2KvYp9iqOiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHlfbWFya3VwPWNoYW5uZWxfbWFya3VwKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxvZ2dpbmcud2FybmluZyhmIlVuYXV0aG9yaXplZCBhY2Nlc3MgYXR0ZW1wdDoge3VzZXJfaWR9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAgICAgICAgICAgICBvdHBfY29kZSA9IHN0cihyYW5kb20ucmFuZGludCgxMDAwMDAsIDk5OTk5OSkpCiAgICAgICAgICAgICAgICBzZWxmLm90cF9jb2Rlc1t1c2VyX2lkXSA9IHNlbGYuZW5jcnlwdG9yLmVuY3J5cHQob3RwX2NvZGUpCiAgICAgICAgICAgICAgICBzZWxmLm90cF9leHBpcnlbdXNlcl9pZF0gPSB0aW1lLnRpbWUoKSArIDMwMCAgIyDZitmG2KrZh9mKINiu2YTYp9mEIDUg2K/Zgtin2KbZggoKICAgICAgICAgICAgICAgIGhvc3RuYW1lID0gc29ja2V0LmdldGhvc3RuYW1lKCkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpcF9hZGRyZXNzID0gc29ja2V0LmdldGhvc3RieW5hbWUoaG9zdG5hbWUpCiAgICAgICAgICAgICAgICBleGNlcHQgc29ja2V0LmdhaWVycm9yOgogICAgICAgICAgICAgICAgICAgIGlwX2FkZHJlc3MgPSAi2LrZitixINmF2LnYsdmI2YEiCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN1cnJlbnRfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlWS0lbS0lZCAlSDolTTolUyIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGF1dGhfbXNnID0gZiIiIgogICAg8J+UkCAq2YPZiNivINin2YTYqtit2YLZgiDYp9mE2K7Yp9i1INio2YMqOiB7b3RwX2NvZGV9CiAgICDij7MgKtmK2YbYqtmH2Yog2K7ZhNin2YQqOiA1INiv2YLYp9im2YIKICAgIPCfkrsgKtin2YTYrNmH2KfYsio6IHtob3N0bmFtZX0KICAgIPCfjJAgKtin2YTYo9mK2KjZiio6IHtpcF9hZGRyZXNzfQogICAg8J+VkiAq2KfZhNmI2YLYqio6IHtjdXJyZW50X3RpbWV9CgogICAg2KPYr9iu2YQg2YfYsNinINin2YTZg9mI2K8g2YHZiiDYo9iv2KfYqSBUZXJtdXguCiAgICAgICAgICAgICAgICAiIiIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY2hhbm5lbF9tYXJrdXAgPSB0eXBlcy5JbmxpbmVLZXlib2FyZE1hcmt1cCgpCiAgICAgICAgICAgICAgICBjaGFubmVsX2J0biA9IHR5cGVzLklubGluZUtleWJvYXJkQnV0dG9uKHRleHQ9ItmC2YbYp9iq2YbYpyDYudmE2Ykg2KfZhNiq2YTZitis2LHYp9mFIiwgdXJsPSJodHRwczovL3QubWUvU3RvcnlfR0EiKQogICAgICAgICAgICAgICAgY2hhbm5lbF9tYXJrdXAuYWRkKGNoYW5uZWxfYnRuKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLmJvdC5zZW5kX21lc3NhZ2UobWVzc2FnZS5jaGF0LmlkLCBhdXRoX21zZywgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICAgICAgc2VsZi5ib3Quc2VuZF9tZXNzYWdlKG1lc3NhZ2UuY2hhdC5pZCwgItiq2KfYqNi52YbYpyDZhNmE2K3YtdmI2YQg2LnZhNmJINii2K7YsSDYp9mE2KrYrdiv2YrYq9in2Ko6IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1jaGFubmVsX21hcmt1cCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2luZy5pbmZvKGYiR2VuZXJhdGVkIE9UUCBmb3IgdXNlcjoge3VzZXJfaWR9IGZvciBkZXZpY2U6IHtob3N0bmFtZX0iKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgaW4gT1RQIGdlbmVyYXRpb246IHtzdHIoZSl9IikKCiAgICAgICAgQHNlbGYuYm90Lm1lc3NhZ2VfaGFuZGxlcihmdW5jPWxhbWJkYSBtZXNzYWdlOiBtZXNzYWdlLnRleHQgPT0gJ/Cfk4og2K3Yp9mE2Kkg2KfZhNit2LPYp9ioJykKICAgICAgICBkZWYgY2hlY2tfc3RhdHVzKG1lc3NhZ2UpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB1c2VyX2lkID0gc3RyKG1lc3NhZ2UuZnJvbV91c2VyLmlkKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjaGFubmVsX21hcmt1cCA9IHR5cGVzLklubGluZUtleWJvYXJkTWFya3VwKCkKICAgICAgICAgICAgICAgIGNoYW5uZWxfYnRuID0gdHlwZXMuSW5saW5lS2V5Ym9hcmRCdXR0b24odGV4dD0i2YLZhtin2KrZhtinINi52YTZiSDYp9mE2KrZhNmK2KzYsdin2YUiLCB1cmw9Imh0dHBzOi8vdC5tZS9TdG9yeV9HQSIpCiAgICAgICAgICAgICAgICBjaGFubmVsX21hcmt1cC5hZGQoY2hhbm5lbF9idG4pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHVzZXJfaWQgaW4gc2VsZi5hdXRoZW50aWNhdGVkX3VzZXJzOgogICAgICAgICAgICAgICAgICAgIHNlbGYuYm90LnNlbmRfbWVzc2FnZShtZXNzYWdlLmNoYXQuaWQsICLinIUgKtis2YTYs9ipINmG2LTYt9ipKiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmJvdC5zZW5kX21lc3NhZ2UobWVzc2FnZS5jaGF0LmlkLCAi4p2MICrZhNinINmK2YjYrNivINis2YTYs9ipINmG2LTYt9ipKiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLmJvdC5zZW5kX21lc3NhZ2UobWVzc2FnZS5jaGF0LmlkLCAi2KrYp9io2LnZhtinINmE2YTYrdi12YjZhCDYudmE2Ykg2KLYrtixINin2YTYqtit2K/Zitir2KfYqjoiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHlfbWFya3VwPWNoYW5uZWxfbWFya3VwKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2dnaW5nLmluZm8oZiJDaGVja2VkIHN0YXR1cyBmb3IgdXNlcjoge3VzZXJfaWR9IikKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIGluIHN0YXR1cyBjaGVjazoge3N0cihlKX0iKQoKICAgICAgICBAc2VsZi5ib3QubWVzc2FnZV9oYW5kbGVyKGZ1bmM9bGFtYmRhIG1lc3NhZ2U6IG1lc3NhZ2UudGV4dCA9PSAn8J+aqiDYqtiz2KzZitmEINin2YTYrtix2YjYrCcpCiAgICAgICAgZGVmIGxvZ291dF91c2VyKG1lc3NhZ2UpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB1c2VyX2lkID0gc3RyKG1lc3NhZ2UuZnJvbV91c2VyLmlkKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjaGFubmVsX21hcmt1cCA9IHR5cGVzLklubGluZUtleWJvYXJkTWFya3VwKCkKICAgICAgICAgICAgICAgIGNoYW5uZWxfYnRuID0gdHlwZXMuSW5saW5lS2V5Ym9hcmRCdXR0b24odGV4dD0i2YLZhtin2KrZhtinINi52YTZiSDYp9mE2KrZhNmK2KzYsdin2YUiLCB1cmw9Imh0dHBzOi8vdC5tZS9TdG9yeV9HQSIpCiAgICAgICAgICAgICAgICBjaGFubmVsX21hcmt1cC5hZGQoY2hhbm5lbF9idG4pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHVzZXJfaWQgaW4gc2VsZi5hdXRoZW50aWNhdGVkX3VzZXJzOgogICAgICAgICAgICAgICAgICAgIHNlbGYuYXV0aGVudGljYXRlZF91c2Vycy5yZW1vdmUodXNlcl9pZCkKICAgICAgICAgICAgICAgICAgICBzZWxmLmJvdC5zZW5kX21lc3NhZ2UobWVzc2FnZS5jaGF0LmlkLCAi4pyFICrYqtmFINiq2LPYrNmK2YQg2KfZhNiu2LHZiNisKiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzZWxmLmJvdC5zZW5kX21lc3NhZ2UobWVzc2FnZS5jaGF0LmlkLCAi4oS577iPICrZhNinINmK2YjYrNivINis2YTYs9ipINmG2LTYt9ipKiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLmJvdC5zZW5kX21lc3NhZ2UobWVzc2FnZS5jaGF0LmlkLCAi2KrYp9io2LnZhtinINmE2YTYrdi12YjZhCDYudmE2Ykg2KLYrtixINin2YTYqtit2K/Zitir2KfYqjoiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHlfbWFya3VwPWNoYW5uZWxfbWFya3VwKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2dnaW5nLmluZm8oZiJVc2VyIGxvZ2dlZCBvdXQ6IHt1c2VyX2lkfSIpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciBpbiBsb2dvdXQ6IHtzdHIoZSl9IikKCiAgICAgICAgQHNlbGYuYm90Lm1lc3NhZ2VfaGFuZGxlcihmdW5jPWxhbWJkYSBtZXNzYWdlOiBtZXNzYWdlLnRleHQgPT0gJ/Cfm6DvuI8g2KfZhNij2K/ZiNin2Kog2KfZhNmF2KrYp9it2KknKQogICAgICAgIGRlZiBsaXN0X3Rvb2xzKG1lc3NhZ2UpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0b29sc19tc2cgPSAiIiIKICAgIPCfm6DvuI8gKtin2YTYo9iv2YjYp9iqINin2YTZhdiq2KfYrdipOioKCiAgICAxLiDYo9iv2YjYp9iqINmI2KfYqtiz2KfYqAogICAgMi4g2KPYr9mI2KfYqiDYp9mE2LPZiNmD2YrYqgogICAgMy4g2KPYr9mI2KfYqiDYp9mE2KPZhdin2YYKICAgIDQuINij2K/ZiNin2KogVGVybXV4INin2YTZhdiz2KfYudiv2KkKICAgIDUuINij2K/ZiNin2Kog2KfZhNmI2KfZiiDZgdin2YoKICAgICAgICAgICAgICAgICIiIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjaGFubmVsX21hcmt1cCA9IHR5cGVzLklubGluZUtleWJvYXJkTWFya3VwKCkKICAgICAgICAgICAgICAgIGNoYW5uZWxfYnRuID0gdHlwZXMuSW5saW5lS2V5Ym9hcmRCdXR0b24odGV4dD0i2YLZhtin2KrZhtinINi52YTZiSDYp9mE2KrZhNmK2KzYsdin2YUiLCB1cmw9Imh0dHBzOi8vdC5tZS9TdG9yeV9HQSIpCiAgICAgICAgICAgICAgICBjaGFubmVsX21hcmt1cC5hZGQoY2hhbm5lbF9idG4pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuYm90LnNlbmRfbWVzc2FnZShtZXNzYWdlLmNoYXQuaWQsIHRvb2xzX21zZywgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICAgICAgc2VsZi5ib3Quc2VuZF9tZXNzYWdlKG1lc3NhZ2UuY2hhdC5pZCwgItiq2KfYqNi52YbYpyDZhNmE2K3YtdmI2YQg2LnZhNmJINii2K7YsSDYp9mE2KrYrdiv2YrYq9in2Ko6IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGx5X21hcmt1cD1jaGFubmVsX21hcmt1cCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIGluIHRvb2xzIGxpc3Rpbmc6IHtzdHIoZSl9IikKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBib3RfdGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5ib3QuaW5maW5pdHlfcG9sbGluZywgZGFlbW9uPVRydWUpCiAgICAgICAgICAgIGJvdF90aHJlYWQuc3RhcnQoKQogICAgICAgICAgICBsb2dnaW5nLmluZm8oIlRlbGVncmFtIGJvdCBzdGFydGVkIHN1Y2Nlc3NmdWxseSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRmFpbGVkIHRvIHN0YXJ0IFRlbGVncmFtIGJvdDoge3N0cihlKX0iKQogICAgICAgICAgICBwcmludChmIkZhaWxlZCB0byBzdGFydCBUZWxlZ3JhbSBib3Q6IHtlfSIpCiAgICBkZWYgb3RwX2F1dGhlbnRpY2F0aW9uKHNlbGYpOgogICAgICAgICIiIkF1dGhlbnRpY2F0ZSB1c2VyIGJ5IHJlZGlyZWN0aW5nIHRvIFRlbGVncmFtIGJvdCIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgb3Muc3lzdGVtKCdjbGVhcicpCiAgICAgICAgICAgIHNlbGYuaW5pdGlhbGl6ZV91aSgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIERpc3BsYXkgaW5zdHJ1Y3Rpb25zCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuIiArICI9IioyMCArICIgVGVsZWdyYW0gQXV0aGVudGljYXRpb24gIiArICI9IioyMCwgJ2N5YW4nKSkKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG5Zb3Ugd2lsbCBiZSByZWRpcmVjdGVkIHRvIHRoZSBUZWxlZ3JhbSBib3QgdG8gZ2V0IHlvdXIgSUQiLCAneWVsbG93JykpCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIkFmdGVyIGdldHRpbmcgeW91ciBJRCwgcmV0dXJuIGhlcmUgdG8gY29tcGxldGUgdGhlIHByb2Nlc3NcbiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgT3BlbiBib3QgVVJMIGRpcmVjdGx5CiAgICAgICAgICAgIGJvdF91cmwgPSAiaHR0cHM6Ly90Lm1lL3VuYmxvY2t3aGF0c2FwcGJvdCIKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIk9wZW5pbmcgVGVsZWdyYW0gYm90OiB7Ym90X3VybH0iLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbInRlcm11eC1vcGVuLXVybCIsIGJvdF91cmxdLCBjaGVjaz1UcnVlKQogICAgICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5DYWxsZWRQcm9jZXNzRXJyb3I6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJDb3VsZG4ndCBvcGVuIFVSTCBhdXRvbWF0aWNhbGx5LiBQbGVhc2Ugb3BlbiBpdCBtYW51YWxseS4iLCAneWVsbG93JykpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFdhaXQgYnJpZWZseSBmb3IgVGVsZWdyYW0gdG8gb3BlbgogICAgICAgICAgICB0aW1lLnNsZWVwKDMpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJlcXVlc3QgSUQgaW5wdXQKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuMS4gSW4gdGhlIGJvdCwgc2VuZCAvaWQgdG8gZ2V0IHlvdXIgSUQiLCAneWVsbG93JykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCIyLiBFbnRlciB5b3VyIElEIGhlcmVcbiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdXNlcl9pZCA9IGlucHV0KGNvbG9yZWQoIkVudGVyIHlvdXIgVGVsZWdyYW0gSUQ6ICIsICdsaWdodF9jeWFuJykpLnN0cmlwKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdXNlcl9pZC5pc2RpZ2l0KCk6CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuYWxsb3dlZF91c2VycyBvciB1c2VyX2lkIGluIHNlbGYuYWxsb3dlZF91c2VyczoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCLim5QgVGhpcyBJRCBpcyBub3QgYWxsb3dlZCEiLCAncmVkJykpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIuKdjCBJbnZhbGlkIElEISBNdXN0IGNvbnRhaW4gbnVtYmVycyBvbmx5IiwgJ3JlZCcpKQoKICAgICAgICAgICAgIyBSZXF1ZXN0IE9UUCBpbnB1dAogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbjEuIEluIHRoZSBib3QsIHNlbmQgL2dldGNvZGUgdG8gZ2V0IHZlcmlmaWNhdGlvbiBjb2RlIiwgJ3llbGxvdycpKQogICAgICAgICAgICBwcmludChjb2xvcmVkKCIyLiBFbnRlciB0aGUgNi1kaWdpdCBjb2RlIGhlcmVcbiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIG1heF9hdHRlbXB0cyA9IDMKICAgICAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UobWF4X2F0dGVtcHRzKToKICAgICAgICAgICAgICAgIGlmIHVzZXJfaWQgaW4gc2VsZi5mYWlsZWRfYXR0ZW1wdHM6CiAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nID0gc2VsZi5nZXRfcmVtYWluaW5nX2RlbGF5KHVzZXJfaWQpCiAgICAgICAgICAgICAgICAgICAgaWYgcmVtYWluaW5nID4gMDoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKPsyBXYWl0IHtyZW1haW5pbmd9IHNlY29uZHMgYmVmb3JlIHRyeWluZyBhZ2FpbiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcChyZW1haW5pbmcpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG90cF9jb2RlID0gaW5wdXQoY29sb3JlZChmIkVudGVyIHZlcmlmaWNhdGlvbiBjb2RlIChBdHRlbXB0IHthdHRlbXB0ICsgMX0ve21heF9hdHRlbXB0c30pOiAiLCAnbGlnaHRfY3lhbicpKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzdG9yZWRfb3RwID0gc2VsZi5lbmNyeXB0b3IuZGVjcnlwdChzZWxmLm90cF9jb2Rlcy5nZXQodXNlcl9pZCwgIiIpKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHN0b3JlZF9vdHAgPSAiIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodXNlcl9pZCBpbiBzZWxmLm90cF9jb2RlcyBhbmQgCiAgICAgICAgICAgICAgICAgICAgc3RvcmVkX290cCA9PSBvdHBfY29kZSBhbmQKICAgICAgICAgICAgICAgICAgICB0aW1lLnRpbWUoKSA8IHNlbGYub3RwX2V4cGlyeS5nZXQodXNlcl9pZCwgMCkpOgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNlbGYuYXV0aGVudGljYXRlZF91c2Vycy5hZGQodXNlcl9pZCkKICAgICAgICAgICAgICAgICAgICBkZWwgc2VsZi5vdHBfY29kZXNbdXNlcl9pZF0KICAgICAgICAgICAgICAgICAgICBkZWwgc2VsZi5vdHBfZXhwaXJ5W3VzZXJfaWRdCiAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsZWRfYXR0ZW1wdHMucG9wKHVzZXJfaWQsIE5vbmUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG7inIUgQXV0aGVudGljYXRpb24gc3VjY2Vzc2Z1bCEiLCAnZ3JlZW4nKSkKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgi4p2MIEludmFsaWQgb3IgZXhwaXJlZCB2ZXJpZmljYXRpb24gY29kZSEiLCAncmVkJykpCiAgICAgICAgICAgICAgICBpZiB1c2VyX2lkIG5vdCBpbiBzZWxmLmZhaWxlZF9hdHRlbXB0czoKICAgICAgICAgICAgICAgICAgICBzZWxmLmZhaWxlZF9hdHRlbXB0c1t1c2VyX2lkXSA9IHsnY291bnQnOiAwLCAndGltZXN0YW1wJzogMH0KICAgICAgICAgICAgICAgIHNlbGYuZmFpbGVkX2F0dGVtcHRzW3VzZXJfaWRdWydjb3VudCddICs9IDEKICAgICAgICAgICAgICAgIHNlbGYuZmFpbGVkX2F0dGVtcHRzW3VzZXJfaWRdWyd0aW1lc3RhbXAnXSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbuKblCBNYXhpbXVtIGF0dGVtcHRzIGV4Y2VlZGVkLiBFeGl0aW5nLi4uIiwgJ3JlZCcpKQogICAgICAgICAgICB0aW1lLnNsZWVwKDMpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIGluIE9UUCBhdXRoZW50aWNhdGlvbjoge3N0cihlKX0iKQogICAgICAgICAgICBwcmludChjb2xvcmVkKGYiQXV0aGVudGljYXRpb24gZXJyb3I6IHtlfSIsICdyZWQnKSkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBkZWYgd2hhdHNhcHBfdG9vbHNfbWVudShzZWxmKToKICAgICAgICAiIiJXaGF0c0FwcCBUb29scyBNZW51IiIiCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgb3Muc3lzdGVtKCdjbGVhcicpCiAgICAgICAgICAgICAgICBzZWxmLmluaXRpYWxpemVfdWkoKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG4iICsgIj0iKjIwICsgIiBXaGF0c0FwcCBUb29scyAiICsgIj0iKjIwLCAnZ3JlZW4nKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIjEuIFNlbmQgV2hhdHNBcHAgTWVzc2FnZSIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCIyLiBTY2FuIFdoYXRzQXBwIE51bWJlciIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCIzLiBDaGVjayBXaGF0c0FwcCBOdW1iZXIiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiMC4gQmFjayB0byBNYWluIE1lbnUiLCAneWVsbG93JykpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNob2ljZSA9IGlucHV0KGNvbG9yZWQoIlxuU2VsZWN0IG9wdGlvbjogIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgY2hvaWNlID09ICIxIjoKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfd2hhdHNhcHBfbWVzc2FnZSgpCiAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMiI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zY2FuX3doYXRzYXBwX251bWJlcigpCiAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMyI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5jaGVja193aGF0c2FwcF9udW1iZXIoKQogICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjAiOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIuKdjCBJbnZhbGlkIG9wdGlvbiEiLCAncmVkJykpCiAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgaW4gV2hhdHNBcHAgbWVudToge3N0cihlKX0iKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIkVycm9yOiB7ZX0iLCAncmVkJykpCgogICAgZGVmIHNlbmRfd2hhdHNhcHBfbWVzc2FnZShzZWxmKToKICAgICAgICAiIiJTZW5kIFdoYXRzQXBwIG1lc3NhZ2UiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuIiArICI9IioyMCArICIgU2VuZCBXaGF0c0FwcCBNZXNzYWdlICIgKyAiPSIqMjAsICdncmVlbicpKQogICAgICAgICAgICBudW1iZXIgPSBpbnB1dChjb2xvcmVkKCJFbnRlciBwaG9uZSBudW1iZXIgKHdpdGggY291bnRyeSBjb2RlKTogIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgbWVzc2FnZSA9IGlucHV0KGNvbG9yZWQoIkVudGVyIG1lc3NhZ2U6ICIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgbnVtYmVyLnN0YXJ0c3dpdGgoIisiKToKICAgICAgICAgICAgICAgIG51bWJlciA9ICIrIiArIG51bWJlcgogICAgICAgICAgICAKICAgICAgICAgICAgdXJsID0gZiJodHRwczovL3dhLm1lL3txdW90ZShudW1iZXIpfT90ZXh0PXtxdW90ZShtZXNzYWdlKX0iCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbk9wZW5pbmcgbGluayBpbiBicm93c2VyLi4uIiwgJ3llbGxvdycpKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbInRlcm11eC1vcGVuLXVybCIsIHVybF0sIGNoZWNrPVRydWUpCiAgICAgICAgICAgICAgICBsb2dnaW5nLmluZm8oZiJDcmVhdGVkIFdoYXRzQXBwIGxpbmsgZm9yIG51bWJlcjoge251bWJlcn0iKQogICAgICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5DYWxsZWRQcm9jZXNzRXJyb3I6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJDb3VsZG4ndCBvcGVuIFVSTCBhdXRvbWF0aWNhbGx5LiBQbGVhc2Ugb3BlbiBpdCBtYW51YWxseS4iLCAneWVsbG93JykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKGYiVVJMOiB7dXJsfSIsICdsaWdodF9jeWFuJykpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChjb2xvcmVkKGYi4p2MIEVycm9yOiB7ZX0iLCAncmVkJykpCiAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciBzZW5kaW5nIFdoYXRzQXBwIG1lc3NhZ2U6IHtzdHIoZSl9IikKCiAgICBkZWYgc2Nhbl93aGF0c2FwcF9udW1iZXIoc2VsZik6CiAgICAgICAgIiIiU2NhbiBXaGF0c0FwcCBudW1iZXIiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuIiArICI9IioyMCArICIgU2NhbiBXaGF0c0FwcCBOdW1iZXIgIiArICI9IioyMCwgJ2dyZWVuJykpCiAgICAgICAgICAgIG51bWJlciA9IGlucHV0KGNvbG9yZWQoIkVudGVyIHBob25lIG51bWJlciAod2l0aCBjb3VudHJ5IGNvZGUpOiAiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IG51bWJlci5zdGFydHN3aXRoKCIrIik6CiAgICAgICAgICAgICAgICBudW1iZXIgPSAiKyIgKyBudW1iZXIKICAgICAgICAgICAgCiAgICAgICAgICAgIHVybCA9IGYiaHR0cHM6Ly9hcGkud2hhdHNhcHAuY29tL3NlbmQ/cGhvbmU9e3F1b3RlKG51bWJlcil9IgogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG5PcGVuaW5nIGxpbmsgaW4gYnJvd3Nlci4uLiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJ0ZXJtdXgtb3Blbi11cmwiLCB1cmxdLCBjaGVjaz1UcnVlKQogICAgICAgICAgICAgICAgbG9nZ2luZy5pbmZvKGYiU2Nhbm5lZCBXaGF0c0FwcCBudW1iZXI6IHtudW1iZXJ9IikKICAgICAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuQ2FsbGVkUHJvY2Vzc0Vycm9yOgogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiQ291bGRuJ3Qgb3BlbiBVUkwgYXV0b21hdGljYWxseS4gUGxlYXNlIG9wZW4gaXQgbWFudWFsbHkuIiwgJ3llbGxvdycpKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIlVSTDoge3VybH0iLCAnbGlnaHRfY3lhbicpKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKdjCBFcnJvcjoge2V9IiwgJ3JlZCcpKQogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3Igc2Nhbm5pbmcgV2hhdHNBcHAgbnVtYmVyOiB7c3RyKGUpfSIpCgogICAgZGVmIGNoZWNrX3doYXRzYXBwX251bWJlcihzZWxmKToKICAgICAgICAiIiJDaGVjayBpZiBudW1iZXIgaXMgb24gV2hhdHNBcHAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuIiArICI9IioyMCArICIgQ2hlY2sgV2hhdHNBcHAgTnVtYmVyICIgKyAiPSIqMjAsICdncmVlbicpKQogICAgICAgICAgICBudW1iZXIgPSBpbnB1dChjb2xvcmVkKCJFbnRlciBwaG9uZSBudW1iZXIgKHdpdGggY291bnRyeSBjb2RlKTogIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBudW1iZXIuc3RhcnRzd2l0aCgiKyIpOgogICAgICAgICAgICAgICAgbnVtYmVyID0gIisiICsgbnVtYmVyCiAgICAgICAgICAgIAogICAgICAgICAgICB1cmwgPSBmImh0dHBzOi8vd2EubWUve3F1b3RlKG51bWJlcil9IgogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG5DaGVja2luZy4uLiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oWyJjdXJsIiwgIi1zIiwgIi1JIiwgdXJsXSwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTEwKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAiMjAwIE9LIiBpbiByZXN1bHQuc3Rkb3V0OgogICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxu4pyFIE51bWJlciBpcyByZWdpc3RlcmVkIG9uIFdoYXRzQXBwIiwgJ2dyZWVuJykpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxu4p2MIE51bWJlciBpcyBub3QgcmVnaXN0ZXJlZCBvbiBXaGF0c0FwcCIsICdyZWQnKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2luZy5pbmZvKGYiQ2hlY2tlZCBXaGF0c0FwcCBudW1iZXI6IHtudW1iZXJ9IikKICAgICAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuVGltZW91dEV4cGlyZWQ6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbuKdjCBSZXF1ZXN0IHRpbWVkIG91dCIsICdyZWQnKSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIlxu4p2MIEVycm9yOiB7ZX0iLCAncmVkJykpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChjb2xvcmVkKGYi4p2MIEVycm9yOiB7ZX0iLCAncmVkJykpCiAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciBjaGVja2luZyBXaGF0c0FwcCBudW1iZXI6IHtzdHIoZSl9IikKCiAgICBkZWYgc29ja2V0X3Rvb2xzX21lbnUoc2VsZik6CiAgICAgICAgIiIiU29ja2V0IFRvb2xzIE1lbnUiIiIKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBvcy5zeXN0ZW0oJ2NsZWFyJykKICAgICAgICAgICAgICAgIHNlbGYuaW5pdGlhbGl6ZV91aSgpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbiIgKyAiPSIqMjAgKyAiIFNvY2tldCBUb29scyAiICsgIj0iKjIwLCAnYmx1ZScpKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiMS4gUG9ydCBTY2FuIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIjIuIE5ldHdvcmsgU2NhbiIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCIzLiBUQ1AgQ29ubmVjdGlvbiBUZXN0IiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIjQuIENyZWF0ZSBTb2NrZXQgU2VydmVyIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIjUuIENyZWF0ZSBTb2NrZXQgQ2xpZW50IiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIjYuIENyZWF0ZSBTb2NrZXQgRmlsZSIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCIwLiBCYWNrIHRvIE1haW4gTWVudSIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY2hvaWNlID0gaW5wdXQoY29sb3JlZCgiXG5TZWxlY3Qgb3B0aW9uOiAiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBjaG9pY2UgPT0gIjEiOgogICAgICAgICAgICAgICAgICAgIHNlbGYucG9ydF9zY2FuKCkKICAgICAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIyIjoKICAgICAgICAgICAgICAgICAgICBzZWxmLm5ldHdvcmtfc2NhbigpCiAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMyI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi50Y3BfdGVzdCgpCiAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNCI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5jcmVhdGVfc29ja2V0X3NlcnZlcigpCiAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNSI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5jcmVhdGVfc29ja2V0X2NsaWVudCgpCiAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNiI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5jcmVhdGVfc29ja2V0X2ZpbGUoKQogICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjAiOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIuKdjCBJbnZhbGlkIG9wdGlvbiEiLCAncmVkJykpCiAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgaW4gc29ja2V0IG1lbnU6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiJFcnJvcjoge2V9IiwgJ3JlZCcpKQoKICAgIGRlZiBwb3J0X3NjYW4oc2VsZik6CiAgICAgICAgIiIiU2NhbiBwb3J0cyBvbiBhbiBJUCBhZGRyZXNzIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbiIgKyAiPSIqMjAgKyAiIFBvcnQgU2NhbiAiICsgIj0iKjIwLCAnYmx1ZScpKQogICAgICAgICAgICB0YXJnZXQgPSBpbnB1dChjb2xvcmVkKCJFbnRlciBJUCBhZGRyZXNzIG9yIGRvbWFpbjogIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgcG9ydHMgPSBpbnB1dChjb2xvcmVkKCJFbnRlciBwb3J0IHJhbmdlIChlLmcuLCAxLTEwMCk6ICIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzdGFydF9wb3J0LCBlbmRfcG9ydCA9IG1hcChpbnQsIHBvcnRzLnNwbGl0KCctJykpCiAgICAgICAgICAgICAgICBpZiBzdGFydF9wb3J0IDwgMSBvciBlbmRfcG9ydCA+IDY1NTM1IG9yIHN0YXJ0X3BvcnQgPiBlbmRfcG9ydDoKICAgICAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yCiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgi4p2MIEludmFsaWQgcG9ydCByYW5nZSEgVXNlIGZvcm1hdCBsaWtlIDEtMTAwIiwgJ3JlZCcpKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChjb2xvcmVkKGYiXG5TY2FubmluZyBwb3J0cyBmcm9tIHtzdGFydF9wb3J0fSB0byB7ZW5kX3BvcnR9IG9uIHt0YXJnZXR9Li4uIiwgJ3llbGxvdycpKQogICAgICAgICAgICAKICAgICAgICAgICAgb3Blbl9wb3J0cyA9IFtdCiAgICAgICAgICAgIHRocmVhZHMgPSBbXQogICAgICAgICAgICAKICAgICAgICAgICAgZGVmIHNjYW5fcG9ydChwb3J0KToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICB3aXRoIHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQsIHNvY2tldC5TT0NLX1NUUkVBTSkgYXMgc29jazoKICAgICAgICAgICAgICAgICAgICAgICAgc29jay5zZXR0aW1lb3V0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHNvY2suY29ubmVjdF9leCgodGFyZ2V0LCBwb3J0KSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzdWx0ID09IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuX3BvcnRzLmFwcGVuZChwb3J0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKchSBQb3J0IHtwb3J0fSBpcyBvcGVuIiwgJ2dyZWVuJykpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBwb3J0IGluIHJhbmdlKHN0YXJ0X3BvcnQsIGVuZF9wb3J0ICsgMSk6CiAgICAgICAgICAgICAgICB0ID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2Nhbl9wb3J0LCBhcmdzPShwb3J0LCkpCiAgICAgICAgICAgICAgICB0aHJlYWRzLmFwcGVuZCh0KQogICAgICAgICAgICAgICAgdC5zdGFydCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZm9yIHQgaW4gdGhyZWFkczoKICAgICAgICAgICAgICAgIHQuam9pbigpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBvcGVuX3BvcnRzOgogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG5PcGVuIHBvcnRzOiAiICsgIiwgIi5qb2luKG1hcChzdHIsIG9wZW5fcG9ydHMpKSwgJ2dyZWVuJykpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbuKdjCBObyBvcGVuIHBvcnRzIGZvdW5kIiwgJ3JlZCcpKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2luZy5pbmZvKGYiU2Nhbm5lZCBwb3J0cyBvbiB7dGFyZ2V0fSBiZXR3ZWVuIHtzdGFydF9wb3J0fS17ZW5kX3BvcnR9IikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiLinYwgRXJyb3I6IHtlfSIsICdyZWQnKSkKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIHNjYW5uaW5nIHBvcnRzOiB7c3RyKGUpfSIpCgogICAgZGVmIG5ldHdvcmtfc2NhbihzZWxmKToKICAgICAgICAiIiJTY2FuIGxvY2FsIG5ldHdvcmsiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuIiArICI9IioyMCArICIgTmV0d29yayBTY2FuICIgKyAiPSIqMjAsICdibHVlJykpCiAgICAgICAgICAgIG5ldHdvcmsgPSBpbnB1dChjb2xvcmVkKCJFbnRlciBuZXR3b3JrIHJhbmdlIChlLmcuLCAxOTIuMTY4LjEpOiAiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHJlLm1hdGNoKHInXlxkezEsM31cLlxkezEsM31cLlxkezEsM30kJywgbmV0d29yayk6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCLinYwgSW52YWxpZCBuZXR3b3JrIGZvcm1hdCEgVXNlIGZvcm1hdCBsaWtlIDE5Mi4xNjguMSIsICdyZWQnKSkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG5TY2FubmluZyBuZXR3b3JrLi4uIiwgJ3llbGxvdycpKQogICAgICAgICAgICAKICAgICAgICAgICAgYWN0aXZlX2hvc3RzID0gW10KICAgICAgICAgICAgdGhyZWFkcyA9IFtdCiAgICAgICAgICAgIAogICAgICAgICAgICBkZWYgcGluZ19ob3N0KGlwKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IG9zLnN5c3RlbShmInBpbmcgLWMgMSAtdyAxIHtpcH0gPiAvZGV2L251bGwgMj4mMSIpCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2UgPT0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlX2hvc3RzLmFwcGVuZChpcCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKchSB7aXB9IGlzIGFjdGl2ZSIsICdncmVlbicpKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiLinYwge2lwfSBpcyBpbmFjdGl2ZSIsICdyZWQnKSkKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMSwgMjU1KToKICAgICAgICAgICAgICAgIGlwID0gZiJ7bmV0d29ya30ue2l9IgogICAgICAgICAgICAgICAgdCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PXBpbmdfaG9zdCwgYXJncz0oaXAsKSkKICAgICAgICAgICAgICAgIHRocmVhZHMuYXBwZW5kKHQpCiAgICAgICAgICAgICAgICB0LnN0YXJ0KCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgdCBpbiB0aHJlYWRzOgogICAgICAgICAgICAgICAgdC5qb2luKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGFjdGl2ZV9ob3N0czoKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuQWN0aXZlIGRldmljZXMgb24gbmV0d29yazoiLCAnZ3JlZW4nKSkKICAgICAgICAgICAgICAgIGZvciBob3N0IGluIGFjdGl2ZV9ob3N0czoKICAgICAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKGhvc3QsICdsaWdodF9ncmVlbicpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG7inYwgTm8gYWN0aXZlIGRldmljZXMgZm91bmQiLCAncmVkJykpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnaW5nLmluZm8oZiJTY2FubmVkIG5ldHdvcms6IHtuZXR3b3JrfS4wLzI0IikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiLinYwgRXJyb3I6IHtlfSIsICdyZWQnKSkKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIHNjYW5uaW5nIG5ldHdvcms6IHtzdHIoZSl9IikKCiAgICBkZWYgdGNwX3Rlc3Qoc2VsZik6CiAgICAgICAgIiIiVGVzdCBUQ1AgY29ubmVjdGlvbiIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG4iICsgIj0iKjIwICsgIiBUQ1AgQ29ubmVjdGlvbiBUZXN0ICIgKyAiPSIqMjAsICdibHVlJykpCiAgICAgICAgICAgIGhvc3QgPSBpbnB1dChjb2xvcmVkKCJFbnRlciBob3N0bmFtZSBvciBJUDogIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgcG9ydCA9IGludChpbnB1dChjb2xvcmVkKCJFbnRlciBwb3J0IG51bWJlcjogIiwgJ2xpZ2h0X2N5YW4nKSkpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwb3J0IDwgMSBvciBwb3J0ID4gNjU1MzU6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCLinYwgSW52YWxpZCBwb3J0IG51bWJlciEgTXVzdCBiZSBiZXR3ZWVuIDEtNjU1MzUiLCAncmVkJykpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuVGVzdGluZyBjb25uZWN0aW9uLi4uIiwgJ3llbGxvdycpKQogICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pIGFzIHNvY2s6CiAgICAgICAgICAgICAgICBzb2NrLnNldHRpbWVvdXQoMykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNvY2suY29ubmVjdCgoaG9zdCwgcG9ydCkpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKchSBUQ1AgY29ubmVjdGlvbiBzdWNjZXNzZnVsIHRvIHtob3N0fTp7cG9ydH0iLCAnZ3JlZW4nKSkKICAgICAgICAgICAgICAgICAgICBsb2dnaW5nLmluZm8oZiJUQ1AgY29ubmVjdGlvbiBzdWNjZXNzZnVsIHRvIHtob3N0fTp7cG9ydH0iKQogICAgICAgICAgICAgICAgZXhjZXB0IHNvY2tldC5lcnJvciBhcyBlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiLinYwgQ29ubmVjdGlvbiBmYWlsZWQgdG8ge2hvc3R9Ontwb3J0fToge2V9IiwgJ3JlZCcpKQogICAgICAgICAgICAgICAgICAgIGxvZ2dpbmcud2FybmluZyhmIlRDUCBjb25uZWN0aW9uIGZhaWxlZCB0byB7aG9zdH06e3BvcnR9OiB7c3RyKGUpfSIpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIuKdjCBJbnZhbGlkIHBvcnQgbnVtYmVyISIsICdyZWQnKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiLinYwgRXJyb3I6IHtlfSIsICdyZWQnKSkKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIGluIFRDUCB0ZXN0OiB7c3RyKGUpfSIpCgogICAgZGVmIGNyZWF0ZV9zb2NrZXRfc2VydmVyKHNlbGYpOgogICAgICAgICIiIkNyZWF0ZSBhIHNpbXBsZSBzb2NrZXQgc2VydmVyIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbiIgKyAiPSIqMjAgKyAiIENyZWF0ZSBTb2NrZXQgU2VydmVyICIgKyAiPSIqMjAsICdibHVlJykpCiAgICAgICAgICAgIGhvc3QgPSBpbnB1dChjb2xvcmVkKCJFbnRlciBob3N0IChsZWF2ZSBlbXB0eSBmb3IgbG9jYWxob3N0KTogIiwgJ2xpZ2h0X2N5YW4nKSkgb3IgJ2xvY2FsaG9zdCcKICAgICAgICAgICAgcG9ydCA9IGludChpbnB1dChjb2xvcmVkKCJFbnRlciBwb3J0IG51bWJlcjogIiwgJ2xpZ2h0X2N5YW4nKSkpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwb3J0IDwgMSBvciBwb3J0ID4gNjU1MzU6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCLinYwgSW52YWxpZCBwb3J0IG51bWJlciEgTXVzdCBiZSBiZXR3ZWVuIDEtNjU1MzUiLCAncmVkJykpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIHdpdGggc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgc29ja2V0LlNPQ0tfU1RSRUFNKSBhcyBzOgogICAgICAgICAgICAgICAgcy5iaW5kKChob3N0LCBwb3J0KSkKICAgICAgICAgICAgICAgIHMubGlzdGVuKCkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiJcbuKchSBTZXJ2ZXIgc3RhcnRlZCBvbiB7aG9zdH06e3BvcnR9IiwgJ2dyZWVuJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJXYWl0aW5nIGZvciBjb25uZWN0aW9ucy4uLiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlByZXNzIEN0cmwrQyB0byBzdG9wIiwgJ3llbGxvdycpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY29ubiwgYWRkciA9IHMuYWNjZXB0KCkKICAgICAgICAgICAgICAgICAgICB3aXRoIGNvbm46CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiJcbkNvbm5lY3RlZCBieSB7YWRkcn0iLCAnZ3JlZW4nKSkKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBjb25uLnJlY3YoMTAyNCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBkYXRhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKGYiUmVjZWl2ZWQ6IHtkYXRhLmRlY29kZSgpfSIsICdsaWdodF9ncmVlbicpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubi5zZW5kYWxsKGRhdGEpICAjIEVjaG8gYmFjawogICAgICAgICAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuU2VydmVyIHN0b3BwZWQiLCAncmVkJykpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIuKdjCBJbnZhbGlkIHBvcnQgbnVtYmVyISIsICdyZWQnKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiLinYwgRXJyb3I6IHtlfSIsICdyZWQnKSkKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIGNyZWF0aW5nIHNvY2tldCBzZXJ2ZXI6IHtzdHIoZSl9IikKCiAgICBkZWYgY3JlYXRlX3NvY2tldF9jbGllbnQoc2VsZik6CiAgICAgICAgIiIiQ3JlYXRlIGEgc2ltcGxlIHNvY2tldCBjbGllbnQiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuIiArICI9IioyMCArICIgQ3JlYXRlIFNvY2tldCBDbGllbnQgIiArICI9IioyMCwgJ2JsdWUnKSkKICAgICAgICAgICAgaG9zdCA9IGlucHV0KGNvbG9yZWQoIkVudGVyIHNlcnZlciBob3N0OiAiLCAnbGlnaHRfY3lhbicpKSBvciAnbG9jYWxob3N0JwogICAgICAgICAgICBwb3J0ID0gaW50KGlucHV0KGNvbG9yZWQoIkVudGVyIHNlcnZlciBwb3J0OiAiLCAnbGlnaHRfY3lhbicpKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHBvcnQgPCAxIG9yIHBvcnQgPiA2NTUzNToKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIuKdjCBJbnZhbGlkIHBvcnQgbnVtYmVyISBNdXN0IGJlIGJldHdlZW4gMS02NTUzNSIsICdyZWQnKSkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pIGFzIHM6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcy5jb25uZWN0KChob3N0LCBwb3J0KSkKICAgICAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKGYiXG7inIUgQ29ubmVjdGVkIHRvIHNlcnZlciBhdCB7aG9zdH06e3BvcnR9IiwgJ2dyZWVuJykpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IGlucHV0KGNvbG9yZWQoIkVudGVyIG1lc3NhZ2UgdG8gc2VuZCAob3IgJ2V4aXQnIHRvIHF1aXQpOiAiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBtZXNzYWdlLmxvd2VyKCkgPT0gJ2V4aXQnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgcy5zZW5kYWxsKG1lc3NhZ2UuZW5jb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBzLnJlY3YoMTAyNCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIlJlY2VpdmVkOiB7ZGF0YS5kZWNvZGUoKX0iLCAnbGlnaHRfZ3JlZW4nKSkKICAgICAgICAgICAgICAgIGV4Y2VwdCBDb25uZWN0aW9uUmVmdXNlZEVycm9yOgogICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIuKdjCBDb25uZWN0aW9uIHJlZnVzZWQuIElzIHRoZSBzZXJ2ZXIgcnVubmluZz8iLCAncmVkJykpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIuKdjCBJbnZhbGlkIHBvcnQgbnVtYmVyISIsICdyZWQnKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiLinYwgRXJyb3I6IHtlfSIsICdyZWQnKSkKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIGNyZWF0aW5nIHNvY2tldCBjbGllbnQ6IHtzdHIoZSl9IikKCiAgICBkZWYgY3JlYXRlX3NvY2tldF9maWxlKHNlbGYpOgogICAgICAgICIiIkNyZWF0ZSBhIFVuaXggZG9tYWluIHNvY2tldCBmaWxlIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbiIgKyAiPSIqMjAgKyAiIENyZWF0ZSBTb2NrZXQgRmlsZSAiICsgIj0iKjIwLCAnYmx1ZScpKQogICAgICAgICAgICBzb2NrZXRfZmlsZSA9IGlucHV0KGNvbG9yZWQoIkVudGVyIHNvY2tldCBmaWxlIHBhdGg6ICIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgc29ja2V0X2ZpbGU6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCLinYwgUGF0aCBjYW5ub3QgYmUgZW1wdHkhIiwgJ3JlZCcpKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb2NrZXRfZmlsZSk6CiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoc29ja2V0X2ZpbGUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9VTklYLCBzb2NrZXQuU09DS19TVFJFQU0pIGFzIHM6CiAgICAgICAgICAgICAgICBzLmJpbmQoc29ja2V0X2ZpbGUpCiAgICAgICAgICAgICAgICBzLmxpc3RlbigpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKGYiXG7inIUgU29ja2V0IGZpbGUgY3JlYXRlZCBhdCB7c29ja2V0X2ZpbGV9IiwgJ2dyZWVuJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJXYWl0aW5nIGZvciBjb25uZWN0aW9ucy4uLiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlByZXNzIEN0cmwrQyB0byBzdG9wIiwgJ3llbGxvdycpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY29ubiwgYWRkciA9IHMuYWNjZXB0KCkKICAgICAgICAgICAgICAgICAgICB3aXRoIGNvbm46CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuQ2xpZW50IGNvbm5lY3RlZCIsICdncmVlbicpKQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGNvbm4ucmVjdigxMDI0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGRhdGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiJSZWNlaXZlZDoge2RhdGEuZGVjb2RlKCl9IiwgJ2xpZ2h0X2dyZWVuJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uLnNlbmRhbGwoZGF0YSkgICMgRWNobyBiYWNrCiAgICAgICAgICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG5TZXJ2ZXIgc3RvcHBlZCIsICdyZWQnKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb2NrZXRfZmlsZSk6CiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoc29ja2V0X2ZpbGUpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChjb2xvcmVkKGYi4p2MIEVycm9yOiB7ZX0iLCAncmVkJykpCiAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciBjcmVhdGluZyBzb2NrZXQgZmlsZToge3N0cihlKX0iKQogICAgICAgICAgICBpZiAnc29ja2V0X2ZpbGUnIGluIGxvY2FscygpIGFuZCBvcy5wYXRoLmV4aXN0cyhzb2NrZXRfZmlsZSk6CiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoc29ja2V0X2ZpbGUpCgogICAgZGVmIHNlY3VyaXR5X3Rvb2xzX21lbnUoc2VsZik6CiAgICAgICAgIiIiU2VjdXJpdHkgVG9vbHMgTWVudSIiIgogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQogICAgICAgICAgICAgICAgc2VsZi5pbml0aWFsaXplX3VpKCkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuIiArICI9IioyMCArICIgU2VjdXJpdHkgVG9vbHMgIiArICI9IioyMCwgJ3JlZCcpKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiMS4gR2VuZXJhdGUgU3Ryb25nIFBhc3N3b3JkIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIjIuIEdlbmVyYXRlIE1ENSBIYXNoIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIjMuIEdlbmVyYXRlIFNIQTI1NiBIYXNoIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIjQuIENoZWNrIEZpbGUgSW50ZWdyaXR5IiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIjAuIEJhY2sgdG8gTWFpbiBNZW51IiwgJ3llbGxvdycpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjaG9pY2UgPSBpbnB1dChjb2xvcmVkKCJcblNlbGVjdCBvcHRpb246ICIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGNob2ljZSA9PSAiMSI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5nZW5lcmF0ZV9zdHJvbmdfcGFzc3dvcmQoKQogICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjIiOgogICAgICAgICAgICAgICAgICAgIHNlbGYuZ2VuZXJhdGVfbWQ1X2hhc2goKQogICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjMiOgogICAgICAgICAgICAgICAgICAgIHNlbGYuZ2VuZXJhdGVfc2hhMjU2X2hhc2goKQogICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjQiOgogICAgICAgICAgICAgICAgICAgIHNlbGYuY2hlY2tfZmlsZV9pbnRlZ3JpdHkoKQogICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjAiOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIuKdjCBJbnZhbGlkIG9wdGlvbiEiLCAncmVkJykpCiAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgaW4gc2VjdXJpdHkgbWVudToge3N0cihlKX0iKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIkVycm9yOiB7ZX0iLCAncmVkJykpCgogICAgZGVmIGdlbmVyYXRlX3N0cm9uZ19wYXNzd29yZChzZWxmKToKICAgICAgICAiIiJHZW5lcmF0ZSBzdHJvbmcgcGFzc3dvcmQiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuIiArICI9IioyMCArICIgR2VuZXJhdGUgU3Ryb25nIFBhc3N3b3JkICIgKyAiPSIqMjAsICdyZWQnKSkKICAgICAgICAgICAgbGVuZ3RoID0gaW50KGlucHV0KGNvbG9yZWQoIkVudGVyIHBhc3N3b3JkIGxlbmd0aCAoOC02NCk6ICIsICdsaWdodF9jeWFuJykpKQogICAgICAgICAgICBsZW5ndGggPSBtYXgoOCwgbWluKDY0LCBsZW5ndGgpKQogICAgICAgICAgICAKICAgICAgICAgICAgY2hhcnMgPSAiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjAxMjM0NTY3ODkhQCMkJV4mKigpIgogICAgICAgICAgICBwYXNzd29yZCA9ICcnLmpvaW4ocmFuZG9tLlN5c3RlbVJhbmRvbSgpLmNob2ljZShjaGFycykgZm9yIF8gaW4gcmFuZ2UobGVuZ3RoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuTmV3IHBhc3N3b3JkOiIsICdncmVlbicpKQogICAgICAgICAgICBwcmludChjb2xvcmVkKHBhc3N3b3JkLCAnbGlnaHRfZ3JlZW4nKSkKICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJHZW5lcmF0ZWQgc3Ryb25nIHBhc3N3b3JkIikKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgi4p2MIEludmFsaWQgbGVuZ3RoISBQbGVhc2UgZW50ZXIgYSBudW1iZXIuIiwgJ3JlZCcpKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKdjCBFcnJvcjoge2V9IiwgJ3JlZCcpKQogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgZ2VuZXJhdGluZyBwYXNzd29yZDoge3N0cihlKX0iKQoKICAgIGRlZiBnZW5lcmF0ZV9tZDVfaGFzaChzZWxmKToKICAgICAgICAiIiJHZW5lcmF0ZSBNRDUgaGFzaCBmb3IgdGV4dCIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG4iICsgIj0iKjIwICsgIiBHZW5lcmF0ZSBNRDUgSGFzaCAiICsgIj0iKjIwLCAncmVkJykpCiAgICAgICAgICAgIHRleHQgPSBpbnB1dChjb2xvcmVkKCJFbnRlciB0ZXh0OiAiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICBtZDVfaGFzaCA9IGhhc2hsaWIubWQ1KHRleHQuZW5jb2RlKCkpLmhleGRpZ2VzdCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbk1ENSBIYXNoOiIsICdncmVlbicpKQogICAgICAgICAgICBwcmludChjb2xvcmVkKG1kNV9oYXNoLCAnbGlnaHRfZ3JlZW4nKSkKICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJHZW5lcmF0ZWQgTUQ1IGhhc2giKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKdjCBFcnJvcjoge2V9IiwgJ3JlZCcpKQogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgZ2VuZXJhdGluZyBNRDUgaGFzaDoge3N0cihlKX0iKQoKICAgIGRlZiBnZW5lcmF0ZV9zaGEyNTZfaGFzaChzZWxmKToKICAgICAgICAiIiJHZW5lcmF0ZSBTSEEyNTYgaGFzaCBmb3IgdGV4dCIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG4iICsgIj0iKjIwICsgIiBHZW5lcmF0ZSBTSEEyNTYgSGFzaCAiICsgIj0iKjIwLCAncmVkJykpCiAgICAgICAgICAgIHRleHQgPSBpbnB1dChjb2xvcmVkKCJFbnRlciB0ZXh0OiAiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICBzaGEyNTZfaGFzaCA9IGhhc2hsaWIuc2hhMjU2KHRleHQuZW5jb2RlKCkpLmhleGRpZ2VzdCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcblNIQTI1NiBIYXNoOiIsICdncmVlbicpKQogICAgICAgICAgICBwcmludChjb2xvcmVkKHNoYTI1Nl9oYXNoLCAnbGlnaHRfZ3JlZW4nKSkKICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJHZW5lcmF0ZWQgU0hBMjU2IGhhc2giKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKdjCBFcnJvcjoge2V9IiwgJ3JlZCcpKQogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgZ2VuZXJhdGluZyBTSEEyNTYgaGFzaDoge3N0cihlKX0iKQoKICAgIGRlZiBjaGVja19maWxlX2ludGVncml0eShzZWxmKToKICAgICAgICAiIiJDaGVjayBmaWxlIGludGVncml0eSB1c2luZyBoYXNoIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbiIgKyAiPSIqMjAgKyAiIENoZWNrIEZpbGUgSW50ZWdyaXR5ICIgKyAiPSIqMjAsICdyZWQnKSkKICAgICAgICAgICAgZmlsZV9wYXRoID0gaW5wdXQoY29sb3JlZCgiRW50ZXIgZmlsZSBwYXRoOiAiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGZpbGVfcGF0aCk6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCLinYwgRmlsZSBkb2VzIG5vdCBleGlzdCEiLCAncmVkJykpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleHBlY3RlZF9oYXNoID0gaW5wdXQoY29sb3JlZCgiRW50ZXIgZXhwZWN0ZWQgaGFzaCAob3B0aW9uYWwpOiAiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG5DYWxjdWxhdGluZyBoYXNoLi4uIiwgJ3llbGxvdycpKQogICAgICAgICAgICAKICAgICAgICAgICAgc2hhMjU2X2hhc2ggPSBoYXNobGliLnNoYTI1NigpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyYicpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgZm9yIGNodW5rIGluIGl0ZXIobGFtYmRhOiBmLnJlYWQoNDA5NiksIGInJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIHNoYTI1Nl9oYXNoLnVwZGF0ZShjaHVuaykKICAgICAgICAgICAgICAgIGZpbGVfaGFzaCA9IHNoYTI1Nl9oYXNoLmhleGRpZ2VzdCgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuRmlsZSBTSEEyNTYgSGFzaDoiLCAnZ3JlZW4nKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZmlsZV9oYXNoLCAnbGlnaHRfZ3JlZW4nKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgZXhwZWN0ZWRfaGFzaDoKICAgICAgICAgICAgICAgICAgICBpZiBmaWxlX2hhc2gubG93ZXIoKSA9PSBleHBlY3RlZF9oYXNoLmxvd2VyKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxu4pyFIEhhc2ggbWF0Y2hlcyAtIEZpbGUgaXMgaW50YWN0IiwgJ2dyZWVuJykpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG7inYwgSGFzaCBtaXNtYXRjaCAtIEZpbGUgbWF5IGJlIG1vZGlmaWVkIiwgJ3JlZCcpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2dnaW5nLmluZm8oZiJDaGVja2VkIGZpbGUgaW50ZWdyaXR5OiB7ZmlsZV9wYXRofSIpCiAgICAgICAgICAgIGV4Y2VwdCBQZXJtaXNzaW9uRXJyb3I6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCLinYwgUGVybWlzc2lvbiBkZW5pZWQgdG8gcmVhZCB0aGUgZmlsZSIsICdyZWQnKSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKdjCBFcnJvciByZWFkaW5nIGZpbGU6IHtlfSIsICdyZWQnKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiLinYwgRXJyb3I6IHtlfSIsICdyZWQnKSkKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIGNoZWNraW5nIGZpbGUgaW50ZWdyaXR5OiB7c3RyKGUpfSIpCgogICAgZGVmIHRlcm11eF91dGlsaXRpZXNfbWVudShzZWxmKToKICAgICAgICAiIiJUZXJtdXggVXRpbGl0aWVzIE1lbnUiIiIKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBvcy5zeXN0ZW0oJ2NsZWFyJykKICAgICAgICAgICAgICAgIHNlbGYuaW5pdGlhbGl6ZV91aSgpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbiIgKyAiPSIqMjAgKyAiIFRlcm11eCBVdGlsaXRpZXMgIiArICI9IioyMCwgJ21hZ2VudGEnKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIjEuIFVwZGF0ZSBQYWNrYWdlcyIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCIyLiBJbnN0YWxsIFBhY2thZ2UiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiMy4gUmVtb3ZlIFBhY2thZ2UiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiNC4gU2hvdyBTeXN0ZW0gSW5mbyIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCI1LiBDbGVhbiBDYWNoZSIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCIwLiBCYWNrIHRvIE1haW4gTWVudSIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY2hvaWNlID0gaW5wdXQoY29sb3JlZCgiXG5TZWxlY3Qgb3B0aW9uOiAiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBjaG9pY2UgPT0gIjEiOgogICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlX3BhY2thZ2VzKCkKICAgICAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIyIjoKICAgICAgICAgICAgICAgICAgICBzZWxmLmluc3RhbGxfcGFja2FnZSgpCiAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMyI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1vdmVfcGFja2FnZSgpCiAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNCI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93X3N5c3RlbV9pbmZvKCkKICAgICAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICI1IjoKICAgICAgICAgICAgICAgICAgICBzZWxmLmNsZWFuX2NhY2hlKCkKICAgICAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIwIjoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCLinYwgSW52YWxpZCBvcHRpb24hIiwgJ3JlZCcpKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIGluIFRlcm11eCB1dGlsaXRpZXMgbWVudToge3N0cihlKX0iKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIkVycm9yOiB7ZX0iLCAncmVkJykpCgogICAgZGVmIHVwZGF0ZV9wYWNrYWdlcyhzZWxmKToKICAgICAgICAiIiJVcGRhdGUgVGVybXV4IHBhY2thZ2VzIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbiIgKyAiPSIqMjAgKyAiIFVwZGF0ZSBQYWNrYWdlcyAiICsgIj0iKjIwLCAnbWFnZW50YScpKQogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcblVwZGF0aW5nIHBhY2thZ2UgbGlzdC4uLiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJwa2ciLCAidXBkYXRlIl0sIGNoZWNrPVRydWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcblVwZ3JhZGluZyBwYWNrYWdlcy4uLiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJwa2ciLCAidXBncmFkZSIsICIteSJdLCBjaGVjaz1UcnVlKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG7inIUgVXBkYXRlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkiLCAnZ3JlZW4nKSkKICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJVcGRhdGVkIFRlcm11eCBwYWNrYWdlcyIpCiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuQ2FsbGVkUHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiLinYwgRXJyb3IgdXBkYXRpbmcgcGFja2FnZXM6IHtlfSIsICdyZWQnKSkKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIHVwZGF0aW5nIFRlcm11eCBwYWNrYWdlczoge3N0cihlKX0iKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKdjCBFcnJvcjoge2V9IiwgJ3JlZCcpKQogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiVW5leHBlY3RlZCBlcnJvciBpbiBwYWNrYWdlIHVwZGF0ZToge3N0cihlKX0iKQoKICAgIGRlZiBpbnN0YWxsX3BhY2thZ2Uoc2VsZik6CiAgICAgICAgIiIiSW5zdGFsbCBwYWNrYWdlIGluIFRlcm11eCIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG4iICsgIj0iKjIwICsgIiBJbnN0YWxsIFBhY2thZ2UgIiArICI9IioyMCwgJ21hZ2VudGEnKSkKICAgICAgICAgICAgcGFja2FnZSA9IGlucHV0KGNvbG9yZWQoIkVudGVyIHBhY2thZ2UgbmFtZTogIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBwYWNrYWdlOgogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgi4p2MIFBhY2thZ2UgbmFtZSBjYW5ub3QgYmUgZW1wdHkhIiwgJ3JlZCcpKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChjb2xvcmVkKGYiXG5JbnN0YWxsaW5nIHtwYWNrYWdlfS4uLiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJwa2ciLCAiaW5zdGFsbCIsICIteSIsIHBhY2thZ2VdLCBjaGVjaz1UcnVlKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIlxu4pyFIHtwYWNrYWdlfSBpbnN0YWxsZWQgc3VjY2Vzc2Z1bGx5IiwgJ2dyZWVuJykpCiAgICAgICAgICAgIGxvZ2dpbmcuaW5mbyhmIkluc3RhbGxlZCBwYWNrYWdlOiB7cGFja2FnZX0iKQogICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLkNhbGxlZFByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgICAgICBwcmludChjb2xvcmVkKGYi4p2MIEVycm9yIGluc3RhbGxpbmcgcGFja2FnZToge2V9IiwgJ3JlZCcpKQogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgaW5zdGFsbGluZyBwYWNrYWdlIHtwYWNrYWdlfToge3N0cihlKX0iKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKdjCBFcnJvcjoge2V9IiwgJ3JlZCcpKQogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiVW5leHBlY3RlZCBlcnJvciBpbiBwYWNrYWdlIGluc3RhbGxhdGlvbjoge3N0cihlKX0iKQoKICAgIGRlZiByZW1vdmVfcGFja2FnZShzZWxmKToKICAgICAgICAiIiJSZW1vdmUgcGFja2FnZSBmcm9tIFRlcm11eCIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG4iICsgIj0iKjIwICsgIiBSZW1vdmUgUGFja2FnZSAiICsgIj0iKjIwLCAnbWFnZW50YScpKQogICAgICAgICAgICBwYWNrYWdlID0gaW5wdXQoY29sb3JlZCgiRW50ZXIgcGFja2FnZSBuYW1lOiAiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHBhY2thZ2U6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCLinYwgUGFja2FnZSBuYW1lIGNhbm5vdCBiZSBlbXB0eSEiLCAncmVkJykpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiJcblJlbW92aW5nIHtwYWNrYWdlfS4uLiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJwa2ciLCAidW5pbnN0YWxsIiwgIi15IiwgcGFja2FnZV0sIGNoZWNrPVRydWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChjb2xvcmVkKGYiXG7inIUge3BhY2thZ2V9IHJlbW92ZWQgc3VjY2Vzc2Z1bGx5IiwgJ2dyZWVuJykpCiAgICAgICAgICAgIGxvZ2dpbmcuaW5mbyhmIlJlbW92ZWQgcGFja2FnZToge3BhY2thZ2V9IikKICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5DYWxsZWRQcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKdjCBFcnJvciByZW1vdmluZyBwYWNrYWdlOiB7ZX0iLCAncmVkJykpCiAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciByZW1vdmluZyBwYWNrYWdlIHtwYWNrYWdlfToge3N0cihlKX0iKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKdjCBFcnJvcjoge2V9IiwgJ3JlZCcpKQogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiVW5leHBlY3RlZCBlcnJvciBpbiBwYWNrYWdlIHJlbW92YWw6IHtzdHIoZSl9IikKCiAgICBkZWYgc2hvd19zeXN0ZW1faW5mbyhzZWxmKToKICAgICAgICAiIiJTaG93IHN5c3RlbSBpbmZvcm1hdGlvbiIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG4iICsgIj0iKjIwICsgIiBTeXN0ZW0gSW5mb3JtYXRpb24gIiArICI9IioyMCwgJ21hZ2VudGEnKSkKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG5HYXRoZXJpbmcgc3lzdGVtIGluZm9ybWF0aW9uLi4uIiwgJ3llbGxvdycpKQogICAgICAgICAgICAKICAgICAgICAgICAgb3NfaW5mbyA9IHN1YnByb2Nlc3MucnVuKFsidW5hbWUiLCAiLWEiXSwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKS5zdGRvdXQKICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG5PUyBJbmZvcm1hdGlvbjoiLCAnZ3JlZW4nKSkKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChvc19pbmZvLnN0cmlwKCksICdsaWdodF9ncmVlbicpKQogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY3B1X2luZm8gPSBzdWJwcm9jZXNzLnJ1bihbImxzY3B1Il0sIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkuc3Rkb3V0CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbkNQVSBJbmZvcm1hdGlvbjoiLCAnZ3JlZW4nKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoY3B1X2luZm8uc3RyaXAoKSwgJ2xpZ2h0X2dyZWVuJykpCiAgICAgICAgICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuQ1BVIEluZm9ybWF0aW9uOiBsc2NwdSBjb21tYW5kIG5vdCBhdmFpbGFibGUiLCAneWVsbG93JykpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBtZW1faW5mbyA9IHN1YnByb2Nlc3MucnVuKFsiZnJlZSIsICItaCJdLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpLnN0ZG91dAogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG5NZW1vcnkgVXNhZ2U6IiwgJ2dyZWVuJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKG1lbV9pbmZvLnN0cmlwKCksICdsaWdodF9ncmVlbicpKQogICAgICAgICAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbk1lbW9yeSBVc2FnZTogZnJlZSBjb21tYW5kIG5vdCBhdmFpbGFibGUiLCAneWVsbG93JykpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkaXNrX2luZm8gPSBzdWJwcm9jZXNzLnJ1bihbImRmIiwgIi1oIl0sIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkuc3Rkb3V0CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJcblN0b3JhZ2UgU3BhY2U6IiwgJ2dyZWVuJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKGRpc2tfaW5mby5zdHJpcCgpLCAnbGlnaHRfZ3JlZW4nKSkKICAgICAgICAgICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG5TdG9yYWdlIFNwYWNlOiBkZiBjb21tYW5kIG5vdCBhdmFpbGFibGUiLCAneWVsbG93JykpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnaW5nLmluZm8oIkRpc3BsYXllZCBzeXN0ZW0gaW5mb3JtYXRpb24iKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIuKdjCBFcnJvcjoge2V9IiwgJ3JlZCcpKQogICAgICAgICAgICBsb2dnaW5nLmVycm9yKGYiRXJyb3IgZGlzcGxheWluZyBzeXN0ZW0gaW5mbzoge3N0cihlKX0iKQoKICAgIGRlZiBjbGVhbl9jYWNoZShzZWxmKToKICAgICAgICAiIiJDbGVhbiBwYWNrYWdlIGNhY2hlIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbiIgKyAiPSIqMjAgKyAiIENsZWFuIENhY2hlICIgKyAiPSIqMjAsICdtYWdlbnRhJykpCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuQ2xlYW5pbmcuLi4iLCAneWVsbG93JykpCiAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsicGtnIiwgImNsZWFuIl0sIGNoZWNrPVRydWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbuKchSBDYWNoZSBjbGVhbmVkIHN1Y2Nlc3NmdWxseSIsICdncmVlbicpKQogICAgICAgICAgICBsb2dnaW5nLmluZm8oIkNsZWFuZWQgcGFja2FnZSBjYWNoZSIpCiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuQ2FsbGVkUHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiLinYwgRXJyb3IgY2xlYW5pbmc6IHtlfSIsICdyZWQnKSkKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIGNsZWFuaW5nIGNhY2hlOiB7c3RyKGUpfSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChjb2xvcmVkKGYi4p2MIEVycm9yOiB7ZX0iLCAncmVkJykpCiAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJVbmV4cGVjdGVkIGVycm9yIGluIGNhY2hlIGNsZWFuaW5nOiB7c3RyKGUpfSIpCgogICAgZGVmIHdpZmlfdG9vbHNfbWVudShzZWxmKToKICAgICAgICAiIiJXaS1GaSBUb29scyBNZW51IiIiCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgb3Muc3lzdGVtKCdjbGVhcicpCiAgICAgICAgICAgICAgICBzZWxmLmluaXRpYWxpemVfdWkoKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG4iICsgIj0iKjIwICsgIiBXaS1GaSBUb29scyAiICsgIj0iKjIwLCAneWVsbG93JykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCIxLiBTY2FuIE5lYXJieSBXaS1GaSBOZXR3b3JrcyIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCIyLiBTaG93IEN1cnJlbnQgV2ktRmkgQ29ubmVjdGlvbiBJbmZvIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIjMuIFRlc3QgSW50ZXJuZXQgU3BlZWQiLCAnbGlnaHRfY3lhbicpKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiMC4gQmFjayB0byBNYWluIE1lbnUiLCAneWVsbG93JykpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNob2ljZSA9IGlucHV0KGNvbG9yZWQoIlxuU2VsZWN0IG9wdGlvbjogIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgY2hvaWNlID09ICIxIjoKICAgICAgICAgICAgICAgICAgICBzZWxmLnNjYW5fd2lmaV9uZXR3b3JrcygpCiAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMiI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93X3dpZmlfaW5mbygpCiAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMyI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi50ZXN0X2ludGVybmV0X3NwZWVkKCkKICAgICAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIwIjoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCLinYwgSW52YWxpZCBvcHRpb24hIiwgJ3JlZCcpKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIGluIFdpLUZpIG1lbnU6IHtzdHIoZSl9IikKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiJFcnJvcjoge2V9IiwgJ3JlZCcpKQoKICAgIGRlZiBzY2FuX3dpZmlfbmV0d29ya3Moc2VsZik6CiAgICAgICAgIiIiU2NhbiBuZWFyYnkgV2ktRmkgbmV0d29ya3MiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuIiArICI9IioyMCArICIgU2NhbiBXaS1GaSBOZXR3b3JrcyAiICsgIj0iKjIwLCAneWVsbG93JykpCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuU2Nhbm5pbmcgbmV0d29ya3MuLi4iLCAneWVsbG93JykpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbInRlcm11eC13aWZpLXNjYW5pbmZvIl0sIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgcmVzdWx0LnJldHVybmNvZGUgPT0gMDoKICAgICAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbkF2YWlsYWJsZSBOZXR3b3JrczoiLCAnZ3JlZW4nKSkKICAgICAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKHJlc3VsdC5zdGRvdXQsICdsaWdodF9ncmVlbicpKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbuKdjCBGYWlsZWQgdG8gc2NhbiBuZXR3b3Jrcy4gTWFrZSBzdXJlIFRlcm11eCBBUEkgaXMgZW5hYmxlZCIsICdyZWQnKSkKICAgICAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJJbnN0YWxsIFRlcm11eDpBUEkgcGFja2FnZSBhbmQgZ3JhbnQgcGVybWlzc2lvbnMiLCAneWVsbG93JykpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvZ2dpbmcuaW5mbygiU2Nhbm5lZCBXaS1GaSBuZXR3b3JrcyIpCiAgICAgICAgICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxu4p2MIHRlcm11eC13aWZpLXNjYW5pbmZvIGNvbW1hbmQgbm90IGZvdW5kIiwgJ3JlZCcpKQogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiSW5zdGFsbCBUZXJtdXg6QVBJIHBhY2thZ2UgZmlyc3QiLCAneWVsbG93JykpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChjb2xvcmVkKGYi4p2MIEVycm9yOiB7ZX0iLCAncmVkJykpCiAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoZiJFcnJvciBzY2FubmluZyBXaS1GaSBuZXR3b3Jrczoge3N0cihlKX0iKQoKICAgIGRlZiBzaG93X3dpZmlfaW5mbyhzZWxmKToKICAgICAgICAiIiJTaG93IGN1cnJlbnQgV2ktRmkgY29ubmVjdGlvbiBpbmZvIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbiIgKyAiPSIqMjAgKyAiIEN1cnJlbnQgV2ktRmkgSW5mbyAiICsgIj0iKjIwLCAneWVsbG93JykpCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuR2F0aGVyaW5nIGluZm9ybWF0aW9uLi4uIiwgJ3llbGxvdycpKQogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oWyJ0ZXJtdXgtd2lmaS1jb25uZWN0aW9uaW5mbyJdLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG5Db25uZWN0aW9uIEluZm86IiwgJ2dyZWVuJykpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZChyZXN1bHQuc3Rkb3V0LCAnbGlnaHRfZ3JlZW4nKSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG7inYwgRmFpbGVkIHRvIGdldCBpbmZvLiBNYWtlIHN1cmUgVGVybXV4IEFQSSBpcyBlbmFibGVkIiwgJ3JlZCcpKQogICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIkluc3RhbGwgVGVybXV4OkFQSSBwYWNrYWdlIGFuZCBncmFudCBwZXJtaXNzaW9ucyIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJEaXNwbGF5ZWQgY3VycmVudCBXaS1GaSBpbmZvIikKICAgICAgICAgICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgiXG7inYwgdGVybXV4LXdpZmktY29ubmVjdGlvbmluZm8gY29tbWFuZCBub3QgZm91bmQiLCAncmVkJykpCiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJJbnN0YWxsIFRlcm11eDpBUEkgcGFja2FnZSBmaXJzdCIsICd5ZWxsb3cnKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiLinYwgRXJyb3I6IHtlfSIsICdyZWQnKSkKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIGRpc3BsYXlpbmcgV2ktRmkgaW5mbzoge3N0cihlKX0iKQoKICAgIGRlZiB0ZXN0X2ludGVybmV0X3NwZWVkKHNlbGYpOgogICAgICAgICIiIlRlc3QgaW50ZXJuZXQgc3BlZWQiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuIiArICI9IioyMCArICIgSW50ZXJuZXQgU3BlZWQgVGVzdCAiICsgIj0iKjIwLCAneWVsbG93JykpCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuVGVzdGluZyBzcGVlZC4uLiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuVGVzdGluZyBkb3dubG9hZCBzcGVlZC4uLiIsICdsaWdodF9jeWFuJykpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRvd25sb2FkX3NwZWVkID0gc3VicHJvY2Vzcy5ydW4oWyJjdXJsIiwgIi1vIiwgIi9kZXYvbnVsbCIsICItdyIsICIle3NwZWVkX2Rvd25sb2FkfSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImh0dHA6Ly9zcGVlZHRlc3QuZnRwLm90ZW5ldC5nci9maWxlcy90ZXN0MTAway5kYiJdLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTMwKS5zdGRvdXQKICAgICAgICAgICAgICAgIGRvd25sb2FkX3NwZWVkID0gZmxvYXQoZG93bmxvYWRfc3BlZWQpIC8gMTAyNAogICAgICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5UaW1lb3V0RXhwaXJlZDoKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxu4p2MIERvd25sb2FkIHRlc3QgdGltZWQgb3V0IiwgJ3JlZCcpKQogICAgICAgICAgICAgICAgZG93bmxvYWRfc3BlZWQgPSAwCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiJcbuKdjCBEb3dubG9hZCB0ZXN0IGZhaWxlZDoge2V9IiwgJ3JlZCcpKQogICAgICAgICAgICAgICAgZG93bmxvYWRfc3BlZWQgPSAwCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcblRlc3RpbmcgdXBsb2FkIHNwZWVkLi4uIiwgJ2xpZ2h0X2N5YW4nKSkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdXBsb2FkX3NwZWVkID0gc3VicHJvY2Vzcy5ydW4oWyJjdXJsIiwgIi1UIiwgIi0iLCAiLS1saW1pdC1yYXRlIiwgIjFNIiwgIi13IiwgIiV7c3BlZWRfdXBsb2FkfSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJodHRwOi8vc3BlZWR0ZXN0LmZ0cC5vdGVuZXQuZ3IvIl0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ9InRlc3QiLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MzApLnN0ZG91dAogICAgICAgICAgICAgICAgdXBsb2FkX3NwZWVkID0gZmxvYXQodXBsb2FkX3NwZWVkKSAvIDEwMjQKICAgICAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuVGltZW91dEV4cGlyZWQ6CiAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbuKdjCBVcGxvYWQgdGVzdCB0aW1lZCBvdXQiLCAncmVkJykpCiAgICAgICAgICAgICAgICB1cGxvYWRfc3BlZWQgPSAwCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiJcbuKdjCBVcGxvYWQgdGVzdCBmYWlsZWQ6IHtlfSIsICdyZWQnKSkKICAgICAgICAgICAgICAgIHVwbG9hZF9zcGVlZCA9IDAKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuU3BlZWQgVGVzdCBSZXN1bHRzOiIsICdncmVlbicpKQogICAgICAgICAgICBwcmludChjb2xvcmVkKGYiRG93bmxvYWQgU3BlZWQ6IHtkb3dubG9hZF9zcGVlZDouMmZ9IEtCL3MiLCAnbGlnaHRfZ3JlZW4nKSkKICAgICAgICAgICAgcHJpbnQoY29sb3JlZChmIlVwbG9hZCBTcGVlZDoge3VwbG9hZF9zcGVlZDouMmZ9IEtCL3MiLCAnbGlnaHRfZ3JlZW4nKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvZ2dpbmcuaW5mbyhmIlRlc3RlZCBpbnRlcm5ldCBzcGVlZDogZG93bmxvYWQ9e2Rvd25sb2FkX3NwZWVkOi4yZn1LQi9zIHVwbG9hZD17dXBsb2FkX3NwZWVkOi4yZn1LQi9zIikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGNvbG9yZWQoZiLinYwgRXJyb3I6IHtlfSIsICdyZWQnKSkKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkVycm9yIHRlc3RpbmcgaW50ZXJuZXQgc3BlZWQ6IHtzdHIoZSl9IikKCiAgICBkZWYgc2hvd19tZW51KHNlbGYpOgogICAgICAgICIiIlNob3cgbWFpbiBtZW51IiIiCiAgICAgICAgcHJpbnQoY29sb3JlZCgiXG4iICsgIj0iKjIwICsgIiBNYWluIE1lbnUgIiArICI9IioyMCwgJ2N5YW4nKSkKICAgICAgICBwcmludChjb2xvcmVkKCIxLiBXaGF0c0FwcCBUb29scyIsICdncmVlbicpKQogICAgICAgIHByaW50KGNvbG9yZWQoIjIuIFNvY2tldCBUb29scyIsICdibHVlJykpCiAgICAgICAgcHJpbnQoY29sb3JlZCgiMy4gU2VjdXJpdHkgVG9vbHMiLCAncmVkJykpCiAgICAgICAgcHJpbnQoY29sb3JlZCgiNC4gVGVybXV4IFV0aWxpdGllcyIsICdtYWdlbnRhJykpCiAgICAgICAgcHJpbnQoY29sb3JlZCgiNS4gV2ktRmkgVG9vbHMiLCAneWVsbG93JykpCiAgICAgICAgcHJpbnQoY29sb3JlZCgiMC4gRXhpdCIsICdsaWdodF9yZWQnKSkKICAgICAgICAKICAgICAgICByZXR1cm4gaW5wdXQoY29sb3JlZCgiXG5TZWxlY3Qgb3B0aW9uOiAiLCAnbGlnaHRfY3lhbicpKQoKICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgIiIiUnVuIHRoZSBhcHBsaWNhdGlvbiIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5zdGFydF90ZWxlZ3JhbV9ib3QoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHNlbGYub3RwX2F1dGhlbnRpY2F0aW9uKCk6CiAgICAgICAgICAgICAgIHN5cy5leGl0KDEpCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaW5pdGlhbGl6ZV91aSgpCiAgICAgICAgICAgICAgICAgICAgY2hvaWNlID0gc2VsZi5zaG93X21lbnUoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGNob2ljZSA9PSAiMSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYud2hhdHNhcHBfdG9vbHNfbWVudSgpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjIiOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNvY2tldF90b29sc19tZW51KCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMyI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2VjdXJpdHlfdG9vbHNfbWVudSgpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjQiOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRlcm11eF91dGlsaXRpZXNfbWVudSgpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjUiOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLndpZmlfdG9vbHNfbWVudSgpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjAiOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChjb2xvcmVkKCJcbkNsb3NpbmcgdG9vbC4uLiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2luZy5pbmZvKCJUb29sIGNsb3NlZCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgb3Muc3lzdGVtKCdjbGVhcicpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoY29sb3JlZCgi4p2MIEludmFsaWQgb3B0aW9uISIsICdyZWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgICAgICAgICAgICAgIHByaW50KGNvbG9yZWQoIlxuUmV0dXJuaW5nIHRvIG1haW4gbWVudS4uLiIsICd5ZWxsb3cnKSkKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgICAgICBwcmludChjb2xvcmVkKCJcblRvb2wgc3RvcHBlZCIsICdyZWQnKSkKICAgICAgICAgICAgbG9nZ2luZy53YXJuaW5nKCJUb29sIHN0b3BwZWQgYnkgdXNlciIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnaW5nLmNyaXRpY2FsKGYiVW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZDoge3N0cihlKX0iLCBleGNfaW5mbz1UcnVlKQogICAgICAgICAgICBwcmludChjb2xvcmVkKGYiQW4gZXJyb3Igb2NjdXJyZWQ6IHtlfSIsICdyZWQnKSkKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICB0cnk6CiAgICAgICAgdG9vbCA9IFRlcm11eE11bHRpVG9vbCgpCiAgICAgICAgdG9vbC5ydW4oKQogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgIHByaW50KGNvbG9yZWQoIlxuVG9vbCBzdG9wcGVkIiwgJ3JlZCcpKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGNvbG9yZWQoZiJFcnJvciBkdXJpbmcgZXhlY3V0aW9uOiB7ZX0iLCAncmVkJykpCiAgICAgICAgbG9nZ2luZy5jcml0aWNhbChmIkVycm9yIGR1cmluZyBleGVjdXRpb246IHtzdHIoZSl9IiwgZXhjX2luZm89VHJ1ZSk=').decode('utf-8'))